<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="format-detection" content="telephone=no">
    <title>æŠ¤å£«å²—ä½AIé¢è¯•ç³»ç»Ÿ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary-color: #4a6cf7;
            --secondary-color: #6c5ce7;
            --success-color: #00b894;
            --warning-color: #fdcb6e;
            --danger-color: #e17055;
            --light-color: #dfe6e9;
            --dark-color: #2d3436;
            --text-color: #2d3436;
            --text-light: #636e72;
            --bg-color: #f8f9fa;
            --card-bg: #ffffff;
            --border-color: #e9ecef;
            --shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            --shadow-hover: 0 4px 20px rgba(0, 0, 0, 0.15);
            --property-card-bg: #ffffff;
            --property-card-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            --property-card-hover: 0 4px 20px rgba(0, 0, 0, 0.15);
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            line-height: 1.6;
            overflow-x: hidden;
        }

        .container {
            max-width: 600px;
            margin: 0 auto;
            min-height: 100vh;
            background-color: var(--card-bg);
            box-shadow: var(--shadow);
        }

        .header {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            padding: 20px;
            text-align: center;
            position: relative;
        }

        .header h1 {
            font-size: 1.8rem;
            font-weight: 700;
            margin-bottom: 8px;
        }

        .header p {
            font-size: 0.9rem;
            opacity: 0.9;
        }

        .content {
            padding: 20px;
        }

        .section-title {
            font-size: 1.3rem;
            font-weight: 600;
            margin-bottom: 20px;
            color: var(--text-color);
        }

        .section-subtitle {
            font-size: 0.95rem;
            color: var(--text-light);
            margin-bottom: 20px;
        }

        .btn {
            display: inline-block;
            width: 100%;
            padding: 14px 20px;
            margin: 10px 0;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            text-align: center;
            text-decoration: none;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            box-shadow: var(--shadow);
            position: relative;
            overflow: hidden;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.3);
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }

        .btn:hover::before {
            width: 300px;
            height: 300px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-hover);
        }

        .btn:active {
            transform: translateY(0);
            box-shadow: var(--shadow);
        }

        .btn span {
            position: relative;
            z-index: 1;
        }

        .btn-secondary {
            background: linear-gradient(135deg, #636e72, #b2bec3);
        }

        .btn-success {
            background: linear-gradient(135deg, var(--success-color), #00cec9);
        }

        .btn-warning {
            background: linear-gradient(135deg, var(--warning-color), #e17055);
        }

        .card {
            background-color: var(--card-bg);
            border-radius: 12px;
            padding: 20px;
            margin: 15px 0;
            box-shadow: var(--shadow);
            transition: all 0.3s ease;
        }

        .card:hover {
            box-shadow: var(--shadow-hover);
            transform: translateY(-2px);
        }

        .card-title {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 10px;
            color: var(--text-color);
        }

        .card-content {
            font-size: 0.95rem;
            color: var(--text-light);
        }

        .form-group {
            margin: 20px 0;
        }

        .form-label {
            display: block;
            font-size: 0.9rem;
            font-weight: 600;
            margin-bottom: 8px;
            color: var(--text-color);
        }

        .form-input {
            width: 100%;
            padding: 12px;
            border: 2px solid var(--border-color);
            border-radius: 8px;
            font-size: 1rem;
            transition: all 0.3s ease;
            background-color: white;
        }

        .form-input:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(74, 108, 247, 0.1);
        }

        .radio-group {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin: 15px 0;
        }

        .radio-item {
            display: flex;
            align-items: center;
            gap: 10px;
            cursor: pointer;
            padding: 10px;
            border-radius: 8px;
            transition: all 0.3s ease;
        }

        .radio-item:hover {
            background-color: rgba(74, 108, 247, 0.05);
        }

        .radio-item input[type="radio"] {
            transform: scale(1.2);
        }

        .radio-item label {
            font-size: 0.95rem;
            cursor: pointer;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background-color: var(--light-color);
            border-radius: 4px;
            margin: 20px 0;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
            border-radius: 4px;
            transition: width 0.3s ease;
        }

        .timer {
            text-align: center;
            font-size: 2rem;
            font-weight: 700;
            color: var(--primary-color);
            margin: 20px 0;
        }

        .question-area {
            background-color: rgba(74, 108, 247, 0.05);
            border-left: 4px solid var(--primary-color);
            padding: 20px;
            border-radius: 0 8px 8px 0;
            margin: 20px 0;
        }

        .question-text {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 10px;
        }

        .answer-area {
            margin: 20px 0;
        }

        .answer-input {
            width: 100%;
            min-height: 150px;
            padding: 15px;
            border: 2px solid var(--border-color);
            border-radius: 8px;
            font-size: 1rem;
            font-family: inherit;
            resize: vertical;
            transition: all 0.3s ease;
        }

        .answer-input:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(74, 108, 247, 0.1);
        }

        .voice-controls {
            display: flex;
            gap: 10px;
            margin: 15px 0;
        }

        .voice-btn {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 8px;
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .voice-btn.active {
            background: linear-gradient(135deg, var(--danger-color), #ff7675);
            color: white;
            animation: pulse 1s infinite;
        }

        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(225, 112, 85, 0.4); }
            70% { box-shadow: 0 0 0 10px rgba(225, 112, 85, 0); }
            100% { box-shadow: 0 0 0 0 rgba(225, 112, 85, 0); }
        }

        .feedback-area {
            background-color: rgba(0, 184, 148, 0.05);
            border-left: 4px solid var(--success-color);
            padding: 15px;
            border-radius: 0 8px 8px 0;
            margin: 20px 0;
        }

        .feedback-title {
            font-size: 1rem;
            font-weight: 600;
            color: var(--success-color);
            margin-bottom: 10px;
        }

        .feedback-content {
            font-size: 0.95rem;
            color: var(--text-light);
        }

        .result-card {
            background: linear-gradient(135deg, rgba(74, 108, 247, 0.1), rgba(108, 92, 231, 0.1));
            border: 2px solid rgba(74, 108, 247, 0.2);
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
            text-align: center;
        }

        .score {
            font-size: 3rem;
            font-weight: 700;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .score-label {
            font-size: 1.1rem;
            color: var(--text-light);
            margin-top: 10px;
        }

        .hidden {
            display: none;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes fadeOut {
            from { opacity: 1; transform: translateY(0); }
            to { opacity: 0; transform: translateY(-20px); }
        }

        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }

        .fade-out {
            animation: fadeOut 0.3s ease-out;
        }

        .slide-in {
            animation: slideIn 0.3s ease-in;
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateX(100%); }
            to { opacity: 1; transform: translateX(0); }
        }

        .step {
            display: none;
        }

        .step.active {
            display: block;
            animation: fadeIn 0.5s ease-in;
        }

        .loading {
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 40px 0;
        }

        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 4px solid rgba(74, 108, 247, 0.1);
            border-left-color: var(--primary-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .icon {
            font-size: 1.5rem;
            margin-right: 10px;
        }

        .navigation {
            display: flex;
            justify-content: space-between;
            margin: 20px 0;
        }

        .nav-btn {
            flex: 1;
            margin: 0 5px;
        }

        @media (max-width: 480px) {
            .container {
                max-width: 100%;
                margin: 0;
                border-radius: 0;
            }

            .header {
                padding: 15px;
            }

            .header h1 {
                font-size: 1.5rem;
            }

            .content {
                padding: 15px;
            }

            .card {
                padding: 15px;
            }

            .btn {
                padding: 12px 16px;
                font-size: 0.95rem;
            }

            .timer {
                font-size: 1.5rem;
            }

            .question-text {
                font-size: 1rem;
            }
        }

        .voice-status {
            text-align: center;
            padding: 10px;
            margin: 10px 0;
            border-radius: 8px;
            font-size: 0.9rem;
            font-weight: 600;
        }

        .voice-status.listening {
            background-color: rgba(0, 184, 148, 0.1);
            color: var(--success-color);
        }

        .voice-status.ready {
            background-color: rgba(74, 108, 247, 0.1);
            color: var(--primary-color);
        }

        .voice-status.error {
            background-color: rgba(225, 112, 85, 0.1);
            color: var(--danger-color);
        }

        .tip {
            background-color: rgba(253, 203, 110, 0.1);
            border-left: 4px solid var(--warning-color);
            padding: 12px;
            border-radius: 0 8px 8px 0;
            margin: 15px 0;
            font-size: 0.9rem;
            color: var(--text-light);
        }

        .step-indicator {
            display: flex;
            justify-content: space-between;
            margin: 20px 0;
            padding: 0 10px;
        }

        .step-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background-color: var(--light-color);
            transition: all 0.3s ease;
        }

        .step-dot.active {
            background-color: var(--primary-color);
            transform: scale(1.3);
        }

        .step-dot.completed {
            background-color: var(--success-color);
        }

        .report-item {
            margin: 15px 0;
            padding: 15px;
            background-color: rgba(74, 108, 247, 0.05);
            border-radius: 8px;
        }

        .report-item-title {
            font-size: 1rem;
            font-weight: 600;
            margin-bottom: 8px;
            color: var(--text-color);
        }

        .report-item-content {
            font-size: 0.95rem;
            color: var(--text-light);
        }

        /* æ•°å­—äººé¢è¯•å®˜æ ·å¼ */
        .interviewer-container {
            text-align: center;
            margin: 20px 0;
        }

        .interviewer-avatar {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            margin: 0 auto 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 4rem;
            color: white;
            box-shadow: var(--shadow-hover);
            transition: all 0.3s ease;
            position: relative;
        }

        /* æ•°å­—äººè¡¨æƒ…åŠ¨ç”» */
        .interviewer-avatar.smile {
            animation: smile 0.5s ease-in-out;
        }

        .interviewer-avatar.nod {
            animation: nod 1s ease-in-out;
        }

        .interviewer-avatar.think {
            animation: think 1.5s ease-in-out;
        }

        @keyframes smile {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        @keyframes nod {
            0%, 100% { transform: rotate(0deg); }
            25% { transform: rotate(10deg); }
            75% { transform: rotate(-10deg); }
        }

        @keyframes think {
            0%, 100% { transform: translateY(0); }
            25% { transform: translateY(-5px) rotate(2deg); }
            75% { transform: translateY(-5px) rotate(-2deg); }
        }

        .interviewer-name {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--text-color);
            margin-bottom: 5px;
        }

        .interviewer-title {
            font-size: 0.9rem;
            color: var(--text-light);
        }

        /* é¢è¯•åé¦ˆæ°”æ³¡ */
        .feedback-bubble {
            background-color: rgba(74, 108, 247, 0.1);
            border: 2px solid rgba(74, 108, 247, 0.2);
            border-radius: 20px;
            padding: 12px 18px;
            margin: 10px auto;
            max-width: 80%;
            text-align: center;
            font-size: 0.95rem;
            color: var(--text-color);
            animation: fadeIn 0.5s ease-in;
            position: relative;
        }

        .feedback-bubble::after {
            content: '';
            position: absolute;
            top: -10px;
            left: 50%;
            transform: translateX(-50%);
            border-width: 0 10px 10px 10px;
            border-style: solid;
            border-color: transparent transparent rgba(74, 108, 247, 0.2) transparent;
        }

        /* å®æ—¶åé¦ˆåŒºåŸŸ */
        .real-time-feedback {
            background-color: rgba(0, 184, 148, 0.05);
            border: 2px solid rgba(0, 184, 148, 0.2);
            border-radius: 12px;
            padding: 15px;
            margin: 20px 0;
            animation: slideIn 0.3s ease-in;
        }

        .feedback-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 10px;
        }

        .feedback-score {
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--success-color);
        }

        .feedback-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin: 10px 0;
        }

        .feedback-tag {
            background-color: rgba(0, 184, 148, 0.1);
            color: var(--success-color);
            padding: 4px 12px;
            border-radius: 15px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        /* è¯­éŸ³åˆæˆæ§åˆ¶ */
        .speech-controls {
            display: flex;
            gap: 10px;
            margin: 15px 0;
            justify-content: center;
        }

        .speech-btn {
            padding: 8px 16px;
            border: none;
            border-radius: 20px;
            background-color: rgba(74, 108, 247, 0.1);
            color: var(--primary-color);
            font-size: 0.85rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .speech-btn:hover {
            background-color: rgba(74, 108, 247, 0.2);
        }

        .speech-btn.active {
            background-color: var(--primary-color);
            color: white;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- æ¬¢è¿é¡µé¢ -->
        <div class="step active" id="step-welcome">
            <div class="header">
                <h1>ğŸ‘©â€âš•ï¸ æŠ¤å£«å²—ä½AIé¢è¯•ç³»ç»Ÿ</h1>
                <p>ä¸“ä¸šæŠ¤ç†é¢è¯•è¯„ä¼°ï¼Œå®æ—¶AIåé¦ˆï¼ŒåŠ©æ‚¨æå‡æŠ¤ç†æŠ€èƒ½</p>
            </div>
            <div class="content">
                <div class="section-title">æ¬¢è¿ä½¿ç”¨æŠ¤å£«å²—ä½AIé¢è¯•ç³»ç»Ÿ</div>
                <div class="section-subtitle">æœ¬ç³»ç»Ÿä¸“ä¸ºæŠ¤ç†ä¸“ä¸šå­¦ç”Ÿå’ŒæŠ¤å£«æ±‚èŒè€…è®¾è®¡ï¼Œé€šè¿‡AIæŠ€æœ¯æä¾›ä¸“ä¸šçš„æŠ¤ç†é¢è¯•è¯„ä¼°å’Œä¸ªæ€§åŒ–åé¦ˆã€‚</div>
                
                <div class="card">
                    <div class="card-title">âœ¨ ç³»ç»Ÿç‰¹è‰²</div>
                    <div class="card-content">
                        <p>â€¢ ä¸“ä¸šæŠ¤ç†é¢è¯•é—®é¢˜åº“ï¼Œè¦†ç›–ä¸´åºŠæŠ¤ç†æŠ€èƒ½</p>
                        <p>â€¢ å®æ—¶AIè¯„ä¼°ï¼Œæä¾›ä¸“ä¸šæŠ¤ç†æŠ€èƒ½åé¦ˆ</p>
                        <p>â€¢ è¯­éŸ³è¯†åˆ«æ”¯æŒï¼Œæ–¹ä¾¿å£è¿°å›ç­”</p>
                        <p>â€¢ ä¸ªæ€§åŒ–æ”¹è¿›å»ºè®®ï¼Œé’ˆå¯¹æ€§æå‡æŠ¤ç†èƒ½åŠ›</p>
                        <p>â€¢ ç®€æ´ç›´è§‚ç•Œé¢ï¼Œé€‚åˆéæŠ€æœ¯äººå‘˜ä½¿ç”¨</p>
                    </div>
                </div>
                
                <button class="btn" onclick="nextStep('step-welcome', 'step-login')"><span>å¼€å§‹é¢è¯•</span></button>
            </div>
        </div>

        <!-- ç™»å½•/æ³¨å†Œé¡µé¢ -->
        <div class="step" id="step-login">
            <div class="header">
                <h1>ğŸ‘¤ ç™»å½•/æ³¨å†Œ</h1>
                <p>è¯·è¾“å…¥æ‚¨çš„ä¿¡æ¯å¼€å§‹é¢è¯•</p>
            </div>
            <div class="content">
                <div class="section-title">ä¸ªäººä¿¡æ¯</div>
                
                <div class="form-group">
                    <label class="form-label" for="name">å§“å</label>
                    <input type="text" id="name" class="form-input" placeholder="è¯·è¾“å…¥æ‚¨çš„å§“å" required>
                </div>
                
                <div class="form-group">
                    <label class="form-label" for="email">é‚®ç®±</label>
                    <input type="email" id="email" class="form-input" placeholder="è¯·è¾“å…¥æ‚¨çš„é‚®ç®±" required>
                </div>
                
                <div class="form-group">
                    <label class="form-label" for="position">åº”è˜èŒä½</label>
                    <select id="position" class="form-input" required>
                        <option value="">è¯·é€‰æ‹©åº”è˜èŒä½</option>
                        <option value="æ™®é€šæŠ¤å£«">æ™®é€šæŠ¤å£«</option>
                        <option value="æŠ¤å¸ˆ">æŠ¤å¸ˆ</option>
                        <option value="ä¸»ç®¡æŠ¤å¸ˆ">ä¸»ç®¡æŠ¤å¸ˆ</option>
                        <option value="å‰¯ä¸»ä»»æŠ¤å¸ˆ">å‰¯ä¸»ä»»æŠ¤å¸ˆ</option>
                        <option value="ä¸»ä»»æŠ¤å¸ˆ">ä¸»ä»»æŠ¤å¸ˆ</option>
                        <option value="ICUæŠ¤å£«">ICUæŠ¤å£«</option>
                        <option value="æ‰‹æœ¯å®¤æŠ¤å£«">æ‰‹æœ¯å®¤æŠ¤å£«</option>
                        <option value="æ€¥è¯ŠæŠ¤å£«">æ€¥è¯ŠæŠ¤å£«</option>
                        <option value="å„¿ç§‘æŠ¤å£«">å„¿ç§‘æŠ¤å£«</option>
                        <option value="äº§ç§‘æŠ¤å£«">äº§ç§‘æŠ¤å£«</option>
                        <option value="å…¶ä»–">å…¶ä»–</option>
                    </select>
                </div>
                
                <div class="navigation">
                    <button class="btn btn-secondary nav-btn" onclick="prevStep('step-login', 'step-welcome')"><span>è¿”å›</span></button>
                    <button class="btn nav-btn" onclick="nextStep('step-login', 'step-select')"><span>ä¸‹ä¸€æ­¥</span></button>
                </div>
            </div>
        </div>

        <!-- é¢è¯•ç±»å‹é€‰æ‹©é¡µé¢ -->
        <div class="step" id="step-select">
            <div class="header">
                <h1>ğŸ¯ é€‰æ‹©é¢è¯•ç±»å‹</h1>
                <p>æ ¹æ®æ‚¨çš„æŠ¤ç†ç»éªŒé€‰æ‹©åˆé€‚çš„é¢è¯•åœºæ™¯</p>
            </div>
            <div class="content">
                <div class="section-title">æŠ¤ç†é¢è¯•ç±»å‹</div>
                <div class="section-subtitle">é€‰æ‹©é€‚åˆæ‚¨çš„æŠ¤ç†ç»éªŒæ°´å¹³ï¼Œç³»ç»Ÿå°†ä¸ºæ‚¨ç”Ÿæˆç›¸åº”çš„ä¸“ä¸šé¢è¯•é—®é¢˜</div>
                
                <div class="radio-group">
                    <div class="radio-item">
                        <input type="radio" id="new-graduate" name="interview-type" value="new-graduate" checked>
                        <label for="new-graduate">ğŸ“ åº”å±Šæ¯•ä¸šç”Ÿ</label>
                    </div>
                    <div class="radio-item">
                        <input type="radio" id="junior-nurse" name="interview-type" value="junior-nurse">
                        <label for="junior-nurse">ğŸ‘©â€âš•ï¸ åˆçº§æŠ¤å£« (1-3å¹´ç»éªŒ)</label>
                    </div>
                    <div class="radio-item">
                        <input type="radio" id="senior-nurse" name="interview-type" value="senior-nurse">
                        <label for="senior-nurse">ğŸ‘¨â€âš•ï¸ èµ„æ·±æŠ¤å£« (3å¹´ä»¥ä¸Šç»éªŒ)</label>
                    </div>
                    <div class="radio-item">
                        <input type="radio" id="specialty" name="interview-type" value="specialty">
                        <label for="specialty">ğŸ¥ ä¸“ç§‘æŠ¤å£«</label>
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label" for="question-count">é—®é¢˜æ•°é‡</label>
                    <input type="range" id="question-count" class="form-input" min="3" max="10" value="5" step="1">
                    <div style="text-align: center; margin: 10px 0; font-weight: 600;"><span id="question-count-value">5</span> ä¸ªé—®é¢˜</div>
                </div>
                
                <div class="navigation">
                    <button class="btn btn-secondary nav-btn" onclick="prevStep('step-select', 'step-login')"><span>è¿”å›</span></button>
                    <button class="btn nav-btn" onclick="startInterview()"><span>å¼€å§‹é¢è¯•</span></button>
                </div>
            </div>
        </div>

        <!-- é¢è¯•å‡†å¤‡é¡µé¢ -->
        <div class="step" id="step-prepare">
            <div class="header">
                <h1>ğŸ“ é¢è¯•å‡†å¤‡</h1>
                <p>åšå¥½å‡†å¤‡ï¼Œå¼€å§‹æ‚¨çš„æŠ¤ç†ä¸“ä¸šé¢è¯•</p>
            </div>
            <div class="content">
                <div class="section-title">é¢è¯•å³å°†å¼€å§‹</div>
                <div class="section-subtitle">è¯·é€‰æ‹©ä¸€ä¸ªå®‰é™çš„ç¯å¢ƒï¼Œå‡†å¤‡å¥½å›ç­”æŠ¤ç†ä¸“ä¸šé—®é¢˜ã€‚</div>
                
                <div class="card">
                    <div class="card-title">ğŸ“‹ é¢è¯•è¯´æ˜</div>
                    <div class="card-content">
                        <p>â€¢ æ¯ä¸ªé—®é¢˜å¯ä»¥è¯­éŸ³æˆ–æ–‡å­—å›ç­”</p>
                        <p>â€¢ AIå°†å®æ—¶è¯„ä¼°æ‚¨çš„æŠ¤ç†ä¸“ä¸šèƒ½åŠ›</p>
                        <p>â€¢ å›ç­”åä¼šç«‹å³æ”¶åˆ°ä¸“ä¸šåé¦ˆ</p>
                        <p>â€¢ æ•´ä¸ªè¿‡ç¨‹çº¦10-15åˆ†é’Ÿ</p>
                    </div>
                </div>
                
                <!-- æŠ¤ç†é¢è¯•é‡ç‚¹ -->
                <div class="card">
                    <div class="card-title">ğŸ‘©â€âš•ï¸ æŠ¤ç†é¢è¯•é‡ç‚¹</div>
                    <div class="card-content">
                        <p>â€¢ é‡ç‚¹å±•ç¤ºæŠ¤ç†ä¸“ä¸šçŸ¥è¯†å’ŒæŠ€èƒ½</p>
                        <p>â€¢ ç»“åˆå®é™…æ¡ˆä¾‹è¯´æ˜æŠ¤ç†ç»éªŒ</p>
                        <p>â€¢ å¼ºè°ƒæ‚£è€…æ²Ÿé€šå’Œå›¢é˜Ÿåä½œèƒ½åŠ›</p>
                        <p>â€¢ ä½“ç°èŒä¸šè´£ä»»æ„Ÿå’Œäººæ–‡å…³æ€€</p>
                    </div>
                </div>
                
                <div class="tip">
                    ğŸ’¡ æç¤ºï¼šç‚¹å‡»"å¼€å§‹é¢è¯•"åï¼Œç³»ç»Ÿå°†ç«‹å³å¼€å§‹æé—®ã€‚å›ç­”æ—¶è¯·å°½é‡è¯¦ç»†ï¼Œä¾¿äºAIè¿›è¡Œä¸“ä¸šè¯„ä¼°ã€‚
                </div>
                
                <div class="navigation">
                    <button class="btn btn-secondary nav-btn" onclick="prevStep('step-prepare', 'step-select')"><span>è¿”å›</span></button>
                    <button class="btn nav-btn" onclick="startInterviewSession()"><span>å¼€å§‹é¢è¯•</span></button>
                </div>
            </div>
        </div>

        <!-- é¢è¯•è¿›è¡Œé¡µé¢ -->
        <div class="step" id="step-interview">
            <div class="header">
                <h1>ğŸ¤ é¢è¯•è¿›è¡Œä¸­</h1>
                <p>è¯·è®¤çœŸå›ç­”æ¯ä¸ªé—®é¢˜</p>
            </div>
            <div class="content">
                <!-- æ•°å­—äººé¢è¯•å®˜ -->
                <div class="interviewer-container">
                    <div class="interviewer-avatar" id="interviewer-avatar">ğŸ¤–</div>
                    <div class="interviewer-name">AIé¢è¯•å®˜</div>
                    <div class="interviewer-title">èµ„æ·±HR & æŠ€æœ¯ä¸“å®¶</div>
                    <div class="feedback-bubble" id="interviewer-feedback">æ¬¢è¿å‚åŠ é¢è¯•ï¼Œè¯·æ”¾æ¾å¿ƒæƒ…ï¼Œå±•ç°çœŸå®çš„è‡ªå·±</div>
                </div>
                
                <div class="step-indicator" id="step-indicator"></div>
                
                <div class="timer" id="timer">00:00</div>
                
                <!-- å®æ—¶æç¤ºåŒºåŸŸ -->
                <div class="tip" id="real-time-tip">ğŸ’¡ æç¤ºï¼šè¯·æ”¾æ¾å¿ƒæƒ…ï¼Œè‡ªç„¶å›ç­”é—®é¢˜</div>
                
                <div class="question-area">
                    <div class="question-text" id="current-question">æ­£åœ¨ç”Ÿæˆé—®é¢˜...</div>
                    <div id="question-hint" style="font-size: 0.9rem; color: var(--text-light); margin-top: 10px;"></div>
                    
                    <!-- è¯­éŸ³åˆæˆæ§åˆ¶ -->
                    <div class="speech-controls">
                        <button class="speech-btn" id="play-question" onclick="playQuestion()">ğŸ”Š æ’­æ”¾é—®é¢˜</button>
                        <button class="speech-btn" id="speed-control" onclick="toggleSpeechSpeed()">â±ï¸ è¯­é€Ÿ: æ­£å¸¸</button>
                    </div>
                </div>
                
                <!-- å®æ—¶åé¦ˆåŒºåŸŸ -->
                <div class="real-time-feedback hidden" id="real-time-feedback">
                    <div class="feedback-header">
                        <h4 class="feedback-title">AIå®æ—¶åé¦ˆ</h4>
                        <span class="feedback-score" id="feedback-score">90</span>
                    </div>
                    <div class="feedback-tags" id="feedback-tags">
                        <span class="feedback-tag">å†…å®¹å®Œæ•´</span>
                        <span class="feedback-tag">é€»è¾‘æ¸…æ™°</span>
                        <span class="feedback-tag">è¡¨è¾¾æµç•…</span>
                    </div>
                    <div class="feedback-content" id="feedback-content">
                        æ‚¨çš„å›ç­”å†…å®¹å®Œæ•´ï¼Œé€»è¾‘æ¸…æ™°ï¼Œè¡¨è¾¾æµç•…ã€‚å»ºè®®åœ¨æè¿°é¡¹ç›®ç»éªŒæ—¶ï¼Œä½¿ç”¨STARæ³•åˆ™ï¼ˆæƒ…å¢ƒã€ä»»åŠ¡ã€è¡ŒåŠ¨ã€ç»“æœï¼‰æ¥ç»“æ„åŒ–æ‚¨çš„å›ç­”ï¼Œè¿™æ ·ä¼šè®©é¢è¯•å®˜æ›´å®¹æ˜“ç†è§£æ‚¨çš„è´¡çŒ®ã€‚
                    </div>
                </div>
                
                <div class="voice-status ready" id="voice-status">ğŸ™ï¸ ç‚¹å‡»éº¦å…‹é£å¼€å§‹å½•éŸ³</div>
                
                <div class="voice-controls">
                    <button class="voice-btn btn-success" id="voice-btn" onclick="toggleVoiceRecognition()">ğŸ¤ å¼€å§‹å½•éŸ³</button>
                </div>
                
                <div class="answer-area">
                    <textarea class="answer-input" id="answer-input" placeholder="æ‚¨çš„å›ç­”..." rows="6"></textarea>
                </div>
                
                <div class="navigation">
                    <button class="btn btn-secondary nav-btn" onclick="prevQuestion()" id="prev-btn" disabled><span>ä¸Šä¸€é¢˜</span></button>
                    <button class="btn nav-btn" onclick="nextQuestion()" id="next-btn"><span>ä¸‹ä¸€é¢˜</span></button>
                </div>
            </div>
        </div>

        <!-- é¢è¯•ç»“æœé¡µé¢ -->
        <div class="step" id="step-result">
            <div class="header">
                <h1>ğŸ† é¢è¯•å®Œæˆ</h1>
                <p>æ‚¨çš„é¢è¯•å·²é¡ºåˆ©å®Œæˆ</p>
            </div>
            <div class="content">
                <div class="result-card">
                    <div class="score" id="total-score">0</div>
                    <div class="score-label">ç»¼åˆè¯„åˆ†</div>
                </div>
                
                <div class="card">
                    <div class="card-title">ğŸ“Š è¯„åˆ†è¯¦æƒ…</div>
                    <div class="card-content" id="score-details"></div>
                </div>
                
                <div class="card">
                    <div class="card-title">ğŸ’¡ é¢è¯•æ€»ç»“</div>
                    <div class="card-content" id="interview-summary"></div>
                </div>
                
                <div class="navigation">
                    <button class="btn btn-secondary nav-btn" onclick="prevStep('step-result', 'step-interview')"><span>è¿”å›</span></button>
                    <button class="btn nav-btn" onclick="shareResults()"><span>åˆ†äº«ç»“æœ</span></button>
                    <button class="btn nav-btn" onclick="generateQRCode()"><span>ç”ŸæˆäºŒç»´ç </span></button>
                    <button class="btn nav-btn" onclick="generateReport()"><span>æŸ¥çœ‹è¯¦ç»†æŠ¥å‘Š</span></button>
                </div>
            </div>
        </div>

        <!-- æŠ¥å‘Šç”Ÿæˆé¡µé¢ -->
        <div class="step" id="step-report">
            <div class="header">
                <h1>ğŸ“‹ é¢è¯•æŠ¥å‘Š</h1>
                <p>è¯¦ç»†çš„é¢è¯•åˆ†ææŠ¥å‘Š</p>
            </div>
            <div class="content">
                <div class="section-title">é¢è¯•æŠ¥å‘Š</div>
                
                <!-- æŠ¥å‘Šå›¾ç‰‡å±•ç¤º -->
                <div class="card" style="margin: 20px 0;">
                    <div class="card-title">ğŸ“Š AIåˆ†ææŠ¥å‘Šå›¾ç‰‡</div>
                    <div class="card-content" style="text-align: center;">
                        <div id="report-preview-container" style="background: #f8f9fa; border: 2px dashed #dfe6e9; border-radius: 8px; padding: 20px; margin: 10px 0; min-height: 200px; display: flex; align-items: center; justify-content: center;">
                            <div id="report-preview-content" style="color: #636e72;">
                                <p>ç‚¹å‡»ä¸‹æ–¹æŒ‰é’®ç”ŸæˆæŠ¥å‘Šå›¾ç‰‡é¢„è§ˆ</p>
                                <button class="btn" onclick="previewReportImage()" style="margin-top: 10px;"><span>ğŸ”„ ç”ŸæˆæŠ¥å‘Šé¢„è§ˆ</span></button>
                            </div>
                        </div>
                        
                        <div style="margin-top: 15px;">
                            <p>ğŸ’¡ æ­¤æŠ¥å‘Šå›¾ç‰‡åŸºäºæ‚¨çš„é¢è¯•æ•°æ®åŠ¨æ€ç”Ÿæˆï¼ŒåŒ…å«å®Œæ•´çš„è¯„åˆ†åˆ†æå’Œä¸“ä¸šå»ºè®®ã€‚</p>
                            <div style="display: flex; gap: 10px; justify-content: center; margin-top: 15px;">
                                <button class="btn" onclick="previewReportImage()"><span>ğŸ”„ é‡æ–°ç”Ÿæˆ</span></button>
                                <button class="btn btn-success" onclick="downloadReportImage()"><span>ğŸ“¥ ä¸‹è½½é«˜æ¸…å›¾ç‰‡</span></button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div id="report-content"></div>
                
                <div class="navigation">
                    <button class="btn btn-secondary nav-btn" onclick="prevStep('step-report', 'step-result')"><span>è¿”å›</span></button>
                    <button class="btn nav-btn" onclick="downloadReport()"><span>ä¸‹è½½æ–‡æœ¬æŠ¥å‘Š</span></button>
                    <button class="btn btn-success nav-btn" onclick="restartInterview()"><span>é‡æ–°é¢è¯•</span></button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // é¢è¯•æ•°æ®
        let interviewData = {
            candidate: {
                name: '',
                email: '',
                position: ''
            },
            type: 'new-graduate',
            questionCount: 5,
            questions: [],
            answers: [],
            currentQuestionIndex: 0,
            startTime: null,
            endTime: null,
            score: 0,
            details: {
                content: 0,
                fluency: 0,
                structure: 0,
                confidence: 0
            }
        };

        // è¯­éŸ³è¯†åˆ«çŠ¶æ€
        let recognition = null;
        let isRecognizing = false;
        let transcript = '';
        
        // è¯­éŸ³åˆæˆçŠ¶æ€
        let speechSynthesis = window.speechSynthesis;
        let speechSpeed = 1.0; // 1.0 æ­£å¸¸è¯­é€Ÿï¼Œ0.5 æ…¢é€Ÿï¼Œ1.5 å¿«é€Ÿ
        let currentUtterance = null;
        
        // æ•°å­—äººçŠ¶æ€
        let interviewerState = 'neutral';
        let currentQuestion = '';
        
        // AIæ¨¡å‹é…ç½®
        const AI_CONFIG = {
            base_url: 'https://api-inference.modelscope.cn/v1',
            api_key: 'ms-35ec79ea-233a-4ccb-b20a-d1d159135d3e',
            model: 'deepseek-ai/DeepSeek-V3.2'
        };

        // åˆå§‹åŒ–è¯­éŸ³è¯†åˆ«
        function initVoiceRecognition() {
            if ('webkitSpeechRecognition' in window) {
                recognition = new webkitSpeechRecognition();
                recognition.continuous = true;
                recognition.interimResults = true;
                recognition.lang = 'zh-CN';
                
                recognition.onstart = function() {
                    isRecognizing = true;
                    document.getElementById('voice-btn').classList.add('active');
                    document.getElementById('voice-btn').textContent = 'â¹ï¸ åœæ­¢å½•éŸ³';
                    document.getElementById('voice-status').className = 'voice-status listening';
                    document.getElementById('voice-status').textContent = 'ğŸ™ï¸ æ­£åœ¨å¬...';
                };
                
                recognition.onresult = function(event) {
                    let interimTranscript = '';
                    for (let i = event.resultIndex; i < event.results.length; i++) {
                        const result = event.results[i];
                        if (result.isFinal) {
                            transcript += result[0].transcript;
                        } else {
                            interimTranscript += result[0].transcript;
                        }
                    }
                    document.getElementById('answer-input').value = transcript + interimTranscript;
                };
                
                recognition.onerror = function(event) {
                    console.error('è¯­éŸ³è¯†åˆ«é”™è¯¯:', event.error);
                    document.getElementById('voice-status').className = 'voice-status error';
                    document.getElementById('voice-status').textContent = 'âŒ è¯­éŸ³è¯†åˆ«å‡ºé”™ï¼Œè¯·é‡è¯•';
                    stopVoiceRecognition();
                };
                
                recognition.onend = function() {
                    stopVoiceRecognition();
                };
            } else {
                document.getElementById('voice-btn').disabled = true;
                document.getElementById('voice-btn').textContent = 'ğŸ¤ æµè§ˆå™¨ä¸æ”¯æŒè¯­éŸ³è¯†åˆ«';
                document.getElementById('voice-status').className = 'voice-status error';
                document.getElementById('voice-status').textContent = 'âŒ æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒè¯­éŸ³è¯†åˆ«åŠŸèƒ½';
            }
        }

        // å¼€å§‹è¯­éŸ³è¯†åˆ«
        function startVoiceRecognition() {
            if (recognition && !isRecognizing) {
                transcript = document.getElementById('answer-input').value;
                recognition.start();
            }
        }

        // åœæ­¢è¯­éŸ³è¯†åˆ«
        function stopVoiceRecognition() {
            if (recognition && isRecognizing) {
                recognition.stop();
                isRecognizing = false;
                document.getElementById('voice-btn').classList.remove('active');
                document.getElementById('voice-btn').textContent = 'ğŸ¤ å¼€å§‹å½•éŸ³';
                document.getElementById('voice-status').className = 'voice-status ready';
                document.getElementById('voice-status').textContent = 'ğŸ™ï¸ ç‚¹å‡»éº¦å…‹é£å¼€å§‹å½•éŸ³';
            }
        }

        // åˆ‡æ¢è¯­éŸ³è¯†åˆ«çŠ¶æ€
        function toggleVoiceRecognition() {
            if (isRecognizing) {
                stopVoiceRecognition();
            } else {
                startVoiceRecognition();
            }
        }

        // æ’­æ”¾é—®é¢˜è¯­éŸ³
        function playQuestion() {
            const questionElement = document.getElementById('current-question');
            const questionText = questionElement.textContent.replace(/^é—®é¢˜ \d+: /, '');
            
            if (speechSynthesis && 'SpeechSynthesisUtterance' in window) {
                // åœæ­¢å½“å‰æ­£åœ¨æ’­æ”¾çš„è¯­éŸ³
                if (currentUtterance) {
                    speechSynthesis.cancel();
                }
                
                const utterance = new SpeechSynthesisUtterance(questionText);
                utterance.lang = 'zh-CN';
                utterance.rate = speechSpeed;
                utterance.pitch = 1.0;
                utterance.volume = 1.0;
                
                // æ›´æ–°æ•°å­—äººè¡¨æƒ…ä¸ºè¯´è¯çŠ¶æ€
                updateInterviewerExpression('speaking');
                
                utterance.onstart = function() {
                    document.getElementById('play-question').textContent = 'â¸ï¸ æš‚åœæ’­æ”¾';
                    document.getElementById('play-question').classList.add('active');
                };
                
                utterance.onend = function() {
                    document.getElementById('play-question').textContent = 'ğŸ”Š æ’­æ”¾é—®é¢˜';
                    document.getElementById('play-question').classList.remove('active');
                    // æ¢å¤æ•°å­—äººè¡¨æƒ…
                    updateInterviewerExpression('neutral');
                    // æ•°å­—äººç‚¹å¤´è¡¨ç¤ºé—®é¢˜ç»“æŸ
                    setTimeout(() => {
                        updateInterviewerExpression('nod');
                    }, 500);
                };
                
                utterance.onerror = function(event) {
                    console.error('è¯­éŸ³åˆæˆé”™è¯¯:', event.error);
                    document.getElementById('play-question').textContent = 'ğŸ”Š æ’­æ”¾é—®é¢˜';
                    document.getElementById('play-question').classList.remove('active');
                    updateInterviewerExpression('neutral');
                };
                
                currentUtterance = utterance;
                speechSynthesis.speak(utterance);
            } else {
                alert('æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒè¯­éŸ³åˆæˆåŠŸèƒ½');
            }
        }

        // åˆ‡æ¢è¯­é€Ÿ
        function toggleSpeechSpeed() {
            const speedBtn = document.getElementById('speed-control');
            
            if (speechSpeed === 1.0) {
                speechSpeed = 1.5;
                speedBtn.textContent = 'â±ï¸ è¯­é€Ÿ: å¿«é€Ÿ';
            } else if (speechSpeed === 1.5) {
                speechSpeed = 0.5;
                speedBtn.textContent = 'â±ï¸ è¯­é€Ÿ: æ…¢é€Ÿ';
            } else {
                speechSpeed = 1.0;
                speedBtn.textContent = 'â±ï¸ è¯­é€Ÿ: æ­£å¸¸';
            }
        }

        // æ›´æ–°æ•°å­—äººè¡¨æƒ…
        function updateInterviewerExpression(state) {
            const avatar = document.getElementById('interviewer-avatar');
            
            // ç§»é™¤æ‰€æœ‰è¡¨æƒ…ç±»
            avatar.classList.remove('smile', 'nod', 'think');
            
            // æ ¹æ®çŠ¶æ€æ·»åŠ è¡¨æƒ…ç±»
            switch(state) {
                case 'smile':
                    avatar.classList.add('smile');
                    interviewerState = 'smile';
                    break;
                case 'nod':
                    avatar.classList.add('nod');
                    interviewerState = 'nod';
                    break;
                case 'think':
                    avatar.classList.add('think');
                    interviewerState = 'think';
                    break;
                case 'speaking':
                    // è¯´è¯æ—¶è½»å¾®æ‘‡å¤´
                    avatar.style.animation = 'think 0.5s ease-in-out infinite';
                    interviewerState = 'speaking';
                    break;
                default:
                    avatar.style.animation = '';
                    interviewerState = 'neutral';
                    break;
            }
        }

        // æ›´æ–°æ•°å­—äººåé¦ˆ
        function updateInterviewerFeedback(feedback) {
            const feedbackBubble = document.getElementById('interviewer-feedback');
            feedbackBubble.textContent = feedback;
            
            // æ˜¾ç¤ºåé¦ˆæ°”æ³¡åŠ¨ç”»
            feedbackBubble.style.animation = 'fadeIn 0.5s ease-in-out';
            setTimeout(() => {
                feedbackBubble.style.animation = '';
            }, 500);
        }

        // ç”ŸæˆæŠ¤å£«ä¸“ä¸šé¢è¯•é—®é¢˜
        function generateQuestions() {
            const questionTypes = {
                "new-graduate": [
                    "è¯·ä»‹ç»ä¸€ä¸‹ä½ çš„æŠ¤ç†ä¸“ä¸šèƒŒæ™¯å’Œå®ä¹ ç»å†ã€‚",
                    "ä½œä¸ºä¸€ååº”å±Šæ¯•ä¸šç”Ÿï¼Œä½ è®¤ä¸ºè‡ªå·±æœ€å¤§çš„ä¼˜åŠ¿æ˜¯ä»€ä¹ˆï¼Ÿ",
                    "è¯·æè¿°ä¸€æ¬¡ä½ åœ¨å®ä¹ ä¸­é‡åˆ°çš„å›°éš¾æƒ…å†µï¼Œä½ æ˜¯å¦‚ä½•å¤„ç†çš„ï¼Ÿ",
                    "ä½ å¯¹æŠ¤ç†å·¥ä½œçš„ç†è§£æ˜¯ä»€ä¹ˆï¼Ÿä¸ºä»€ä¹ˆé€‰æ‹©æŠ¤ç†è¿™ä¸ªèŒä¸šï¼Ÿ",
                    "åœ¨ç´§æ€¥æƒ…å†µä¸‹ï¼Œä½ ä¼šå¦‚ä½•ä¿æŒå†·é™å¹¶é‡‡å–æ­£ç¡®çš„æŠ¤ç†æªæ–½ï¼Ÿ",
                    "è¯·è°ˆè°ˆä½ å¯¹æ‚£è€…æ²Ÿé€šé‡è¦æ€§çš„ç†è§£ã€‚",
                    "ä½œä¸ºä¸€åæ–°æŠ¤å£«ï¼Œä½ å¦‚ä½•å¿«é€Ÿé€‚åº”åŒ»é™¢çš„å·¥ä½œç¯å¢ƒï¼Ÿ",
                    "è¯·æè¿°ä¸€æ¬¡ä½ æˆåŠŸå¸®åŠ©æ‚£è€…çš„ç»å†ã€‚",
                    "ä½ å¯¹æŠ¤ç†èŒä¸šçš„æœªæ¥å‘å±•æœ‰ä»€ä¹ˆè§„åˆ’ï¼Ÿ",
                    "å¦‚ä½•å¤„ç†ä¸æ‚£è€…å®¶å±çš„æ²Ÿé€šå’ŒçŸ›ç›¾ï¼Ÿ"
                ],
                "junior-nurse": [
                    "è¯·åˆ†äº«ä¸€æ¬¡ä½ å¤„ç†å¤æ‚æŠ¤ç†ç—…ä¾‹çš„ç»éªŒã€‚",
                    "åœ¨å·¥ä½œä¸­ï¼Œä½ å¦‚ä½•ç¡®ä¿æŠ¤ç†æ“ä½œçš„å‡†ç¡®æ€§å’Œå®‰å…¨æ€§ï¼Ÿ",
                    "è¯·æè¿°ä¸€æ¬¡ä½ ä¸åŒ»ç”Ÿåä½œå®Œæˆæ²»ç–—æ–¹æ¡ˆçš„ç»å†ã€‚",
                    "ä½ å¦‚ä½•ç®¡ç†è‡ªå·±çš„å·¥ä½œæ—¶é—´ï¼Œç¡®ä¿æ‰€æœ‰æ‚£è€…å¾—åˆ°åŠæ—¶æŠ¤ç†ï¼Ÿ",
                    "è¯·è°ˆè°ˆä½ å¯¹æŠ¤ç†è®°å½•é‡è¦æ€§çš„ç†è§£ã€‚",
                    "å¦‚ä½•å¤„ç†æƒ…ç»ªæ¿€åŠ¨çš„æ‚£è€…æˆ–å®¶å±ï¼Ÿ",
                    "è¯·åˆ†äº«ä¸€æ¬¡ä½ å‘ç°å¹¶çº æ­£æŠ¤ç†é”™è¯¯çš„ç»å†ã€‚",
                    "ä½ å¦‚ä½•ä¿æŒæŠ¤ç†ä¸“ä¸šçŸ¥è¯†çš„æ›´æ–°ï¼Ÿ",
                    "è¯·æè¿°ä¸€æ¬¡ä½ åœ¨å›¢é˜Ÿä¸­å‘æŒ¥é‡è¦ä½œç”¨çš„ç»å†ã€‚",
                    "ä½ å¯¹æŠ¤ç†è´¨é‡æ”¹è¿›æœ‰ä»€ä¹ˆå»ºè®®ï¼Ÿ"
                ],
                "senior-nurse": [
                    "è¯·åˆ†äº«ä¸€æ¬¡ä½ æŒ‡å¯¼æ–°æŠ¤å£«çš„ç»éªŒã€‚",
                    "ä½œä¸ºèµ„æ·±æŠ¤å£«ï¼Œä½ å¦‚ä½•å‚ä¸ç§‘å®¤çš„è´¨é‡ç®¡ç†ï¼Ÿ",
                    "è¯·æè¿°ä¸€æ¬¡ä½ å¤„ç†å¤æ‚åŒ»ç–—çº çº·çš„ç»å†ã€‚",
                    "ä½ å¦‚ä½•è¯„ä¼°å’Œæå‡ç§‘å®¤çš„æŠ¤ç†æœåŠ¡æ°´å¹³ï¼Ÿ",
                    "è¯·è°ˆè°ˆä½ å¯¹æŠ¤ç†ç§‘ç ”å’Œæ•™å­¦çš„ç†è§£ã€‚",
                    "å¦‚ä½•å¤„ç†è·¨ç§‘å®¤åä½œä¸­çš„é—®é¢˜ï¼Ÿ",
                    "è¯·åˆ†äº«ä¸€æ¬¡ä½ å‚ä¸åˆ¶å®šæŠ¤ç†æµç¨‹çš„ç»éªŒã€‚",
                    "ä½ å¦‚ä½•åŸ¹å…»å¹´è½»æŠ¤å£«çš„ä¸“ä¸šèƒ½åŠ›ï¼Ÿ",
                    "è¯·æè¿°ä¸€æ¬¡ä½ åœ¨ç´§æ€¥æƒ…å†µä¸‹é¢†å¯¼å›¢é˜Ÿçš„ç»å†ã€‚",
                    "ä½ å¯¹æŠ¤ç†èŒä¸šå‘å±•çš„é•¿æœŸè§„åˆ’æ˜¯ä»€ä¹ˆï¼Ÿ"
                ],
                "specialty": [
                    "è¯·ä»‹ç»ä½ åœ¨ä¸“ç§‘æŠ¤ç†é¢†åŸŸçš„ä¸“ä¸šç‰¹é•¿ã€‚",
                    "è¯·åˆ†äº«ä¸€æ¬¡ä½ å¤„ç†ä¸“ç§‘å¤æ‚ç—…ä¾‹çš„ç»éªŒã€‚",
                    "ä½ å¦‚ä½•ä¿æŒä¸“ç§‘æŠ¤ç†çŸ¥è¯†çš„å‰æ²¿æ€§ï¼Ÿ",
                    "è¯·è°ˆè°ˆä½ å¯¹ä¸“ç§‘æŠ¤ç†è´¨é‡æ ‡å‡†çš„ç†è§£ã€‚",
                    "åœ¨ä¸“ç§‘æŠ¤ç†ä¸­ï¼Œä½ å¦‚ä½•ä¸å¤šå­¦ç§‘å›¢é˜Ÿåä½œï¼Ÿ",
                    "è¯·æè¿°ä¸€æ¬¡ä½ å‚ä¸ä¸“ç§‘æŠ¤ç†ç ”ç©¶çš„ç»å†ã€‚",
                    "ä½ å¦‚ä½•ä¸ºä¸“ç§‘æ‚£è€…æä¾›ä¸ªæ€§åŒ–æŠ¤ç†æ–¹æ¡ˆï¼Ÿ",
                    "è¯·åˆ†äº«ä¸€æ¬¡ä½ åœ¨ä¸“ç§‘æŠ¤ç†ä¸­é‡åˆ°çš„æŒ‘æˆ˜å’Œè§£å†³æ–¹æ¡ˆã€‚",
                    "ä½ å¦‚ä½•è¯„ä¼°ä¸“ç§‘æŠ¤ç†çš„æ•ˆæœå’Œè´¨é‡ï¼Ÿ",
                    "è¯·è°ˆè°ˆä½ å¯¹ä¸“ç§‘æŠ¤ç†æœªæ¥å‘å±•çš„çœ‹æ³•ã€‚"
                ]
            };

            const questions = questionTypes[interviewData.type] || questionTypes["new-graduate"];
            const selectedQuestions = [];
            
            // éšæœºé€‰æ‹©æŒ‡å®šæ•°é‡çš„é—®é¢˜
            while (selectedQuestions.length < interviewData.questionCount && questions.length > 0) {
                const randomIndex = Math.floor(Math.random() * questions.length);
                selectedQuestions.push(questions[randomIndex]);
                questions.splice(randomIndex, 1);
            }
            
            return selectedQuestions;
        }

        // æ˜¾ç¤ºå½“å‰é—®é¢˜
        function displayCurrentQuestion() {
            if (interviewData.currentQuestionIndex < interviewData.questions.length) {
                const question = interviewData.questions[interviewData.currentQuestionIndex];
                currentQuestion = question;
                document.getElementById('current-question').textContent = `é—®é¢˜ ${interviewData.currentQuestionIndex + 1}: ${question}`;
                document.getElementById('question-hint').textContent = `â±ï¸ å»ºè®®å›ç­”æ—¶é—´ï¼š2-3åˆ†é’Ÿ`;
                
                // æ¢å¤ä¹‹å‰çš„å›ç­”ï¼ˆå¦‚æœæœ‰ï¼‰
                const answer = interviewData.answers[interviewData.currentQuestionIndex] || '';
                document.getElementById('answer-input').value = answer;
                
                // æ›´æ–°å¯¼èˆªæŒ‰é’®çŠ¶æ€
                updateNavButtons();
                
                // æ›´æ–°æ­¥éª¤æŒ‡ç¤ºå™¨
                updateStepIndicator();
                
                // éšè—ä¹‹å‰çš„å®æ—¶åé¦ˆ
                document.getElementById('real-time-feedback').classList.add('hidden');
                
                // æ›´æ–°æ•°å­—äººçŠ¶æ€
                updateInterviewerExpression('think');
                
                // æ•°å­—äººæ€è€ƒåè¯´è¯
                setTimeout(() => {
                    updateInterviewerFeedback(`ç°åœ¨æ˜¯ç¬¬ ${interviewData.currentQuestionIndex + 1} ä¸ªé—®é¢˜ï¼Œè¯·å¬é¢˜ï¼š`);
                    updateInterviewerExpression('neutral');
                    
                    // è‡ªåŠ¨æ’­æ”¾é—®é¢˜è¯­éŸ³
                    setTimeout(() => {
                        playQuestion();
                    }, 1000);
                }, 1000);
                
                // æ•°å­—äººå¾®ç¬‘é¼“åŠ±
                setTimeout(() => {
                    updateInterviewerExpression('smile');
                    updateInterviewerFeedback('è¯·å¼€å§‹ä½ çš„å›ç­”ï¼Œä¸è¦ç´§å¼ ');
                }, 3000);
            } else {
                // é¢è¯•ç»“æŸ
                endInterview();
            }
        }

        // æ›´æ–°å¯¼èˆªæŒ‰é’®çŠ¶æ€
        function updateNavButtons() {
            const prevBtn = document.getElementById('prev-btn');
            const nextBtn = document.getElementById('next-btn');
            
            prevBtn.disabled = interviewData.currentQuestionIndex === 0;
            
            if (interviewData.currentQuestionIndex === interviewData.questions.length - 1) {
                nextBtn.textContent = 'å®Œæˆé¢è¯•';
            } else {
                nextBtn.textContent = 'ä¸‹ä¸€é¢˜';
            }
        }

        // æ›´æ–°æ­¥éª¤æŒ‡ç¤ºå™¨
        function updateStepIndicator() {
            const indicator = document.getElementById('step-indicator');
            indicator.innerHTML = '';
            
            for (let i = 0; i < interviewData.questions.length; i++) {
                const dot = document.createElement('div');
                dot.className = 'step-dot';
                
                if (i < interviewData.currentQuestionIndex) {
                    dot.classList.add('completed');
                } else if (i === interviewData.currentQuestionIndex) {
                    dot.classList.add('active');
                }
                
                indicator.appendChild(dot);
            }
        }

        // ä¸Šä¸€é¢˜
        function prevQuestion() {
            if (interviewData.currentQuestionIndex > 0) {
                // ä¿å­˜å½“å‰å›ç­”
                saveCurrentAnswer();
                interviewData.currentQuestionIndex--;
                displayCurrentQuestion();
            }
        }

        // ä¸‹ä¸€é¢˜
        function nextQuestion() {
            // ä¿å­˜å½“å‰å›ç­”
            saveCurrentAnswer();
            
            // å¦‚æœæ˜¯æœ€åä¸€é¢˜ï¼Œç»“æŸé¢è¯•
            if (interviewData.currentQuestionIndex >= interviewData.questions.length - 1) {
                endInterview();
                return;
            }
            
            // ç”ŸæˆAIå®æ—¶åé¦ˆ
            generateAIFeedback();
            
            // å»¶è¿Ÿåˆ‡æ¢åˆ°ä¸‹ä¸€é¢˜ï¼Œè®©ç”¨æˆ·æœ‰æ—¶é—´æŸ¥çœ‹åé¦ˆ
            setTimeout(() => {
                interviewData.currentQuestionIndex++;
                displayCurrentQuestion();
            }, 3000);
        }

        // ä¿å­˜å½“å‰å›ç­”
        function saveCurrentAnswer() {
            const answer = document.getElementById('answer-input').value;
            interviewData.answers[interviewData.currentQuestionIndex] = answer;
        }

        // ç”ŸæˆAIå®æ—¶åé¦ˆ
        function generateAIFeedback() {
            const currentIndex = interviewData.currentQuestionIndex;
            const question = interviewData.questions[currentIndex];
            const answer = interviewData.answers[currentIndex] || '';
            
            // ç®€å•çš„AIåé¦ˆç®—æ³•ï¼ˆå®é™…åº”ç”¨ä¸­å¯æ¥å…¥çœŸå®AI APIï¼‰
            const feedback = analyzeAnswer(question, answer);
            
            // æ˜¾ç¤ºå®æ—¶åé¦ˆ
            displayFeedback(feedback);
            
            // æ›´æ–°æ•°å­—äººçŠ¶æ€
            updateInterviewerExpression('nod');
            updateInterviewerFeedback('æ‚¨çš„å›ç­”å·²æ”¶åˆ°ï¼Œæ­£åœ¨ç”Ÿæˆåé¦ˆ...');
            
            // å»¶è¿Ÿæ˜¾ç¤ºæ•°å­—äººå¯¹åé¦ˆçš„ååº”
            setTimeout(() => {
                if (feedback.score >= 85) {
                    updateInterviewerExpression('smile');
                    updateInterviewerFeedback('å›ç­”å¾—å¾ˆå¥½ï¼ç»§ç»­ä¿æŒï¼');
                } else if (feedback.score >= 70) {
                    updateInterviewerExpression('neutral');
                    updateInterviewerFeedback('å›ç­”ä¸é”™ï¼Œè¿˜æœ‰æ”¹è¿›ç©ºé—´ã€‚');
                } else {
                    updateInterviewerExpression('think');
                    updateInterviewerFeedback('å»ºè®®å†æ·±å…¥æ€è€ƒä¸€ä¸‹è¿™ä¸ªé—®é¢˜ã€‚');
                }
            }, 1000);
        }

        // åˆ†æå›ç­”å¹¶ç”ŸæˆæŠ¤ç†ä¸“ä¸šåé¦ˆ
        function analyzeAnswer(question, answer) {
            // åŸºç¡€è¯„åˆ†
            let score = 70;
            
            // æ ¹æ®å›ç­”é•¿åº¦è¯„åˆ†ï¼ˆ10-500å­—ï¼‰
            const answerLength = answer.length;
            if (answerLength >= 10 && answerLength <= 100) {
                score += 5;
            } else if (answerLength > 100 && answerLength <= 300) {
                score += 15;
            } else if (answerLength > 300 && answerLength <= 500) {
                score += 10;
            }
            
            // æ ¹æ®æŠ¤ç†ä¸“ä¸šå…³é”®è¯è¯„åˆ†
            const keywords = getNursingKeywords(question);
            const matchedKeywords = countMatchedKeywords(answer, keywords);
            if (matchedKeywords > 0) {
                score += matchedKeywords * 5;
            }
            
            // ç¡®ä¿è¯„åˆ†åœ¨0-100ä¹‹é—´
            score = Math.min(Math.max(score, 0), 100);
            
            // ç”ŸæˆæŠ¤ç†ä¸“ä¸šåé¦ˆæ ‡ç­¾
            const tags = [];
            if (score >= 90) {
                tags.push('ä¼˜ç§€');
                tags.push('ä¸“ä¸šæ€§å¼º');
                tags.push('é€»è¾‘æ¸…æ™°');
            } else if (score >= 80) {
                tags.push('è‰¯å¥½');
                tags.push('è¡¨è¾¾æµç•…');
                tags.push('ç»“æ„åˆç†');
            } else if (score >= 70) {
                tags.push('ä¸€èˆ¬');
                tags.push('éœ€è¦è¡¥å……');
                tags.push('ä¸“ä¸šå¾…åŠ å¼º');
            } else {
                tags.push('éœ€æ”¹è¿›');
                tags.push('å†…å®¹å•è–„');
                tags.push('ä¸“ä¸šä¸è¶³');
            }
            
            // ç”Ÿæˆè¯¦ç»†æŠ¤ç†ä¸“ä¸šåé¦ˆå†…å®¹
            let feedbackContent = '';
            if (score >= 90) {
                feedbackContent = 'æ‚¨çš„å›ç­”éå¸¸å‡ºè‰²ï¼å†…å®¹å®Œæ•´ï¼Œé€»è¾‘æ¸…æ™°ï¼Œä½“ç°äº†ä¸“ä¸šçš„æŠ¤ç†çŸ¥è¯†å’Œä¸´åºŠæ€ç»´ã€‚å»ºè®®ç»§ç»­ä¿æŒè¿™ç§ä¸“ä¸šæ°´å‡†ã€‚';
            } else if (score >= 80) {
                feedbackContent = 'æ‚¨çš„å›ç­”æ•´ä½“ä¸é”™ï¼Œè¡¨è¾¾æµç•…ï¼Œç»“æ„åˆç†ã€‚å»ºè®®å¯ä»¥åŠ å…¥æ›´å¤šå…·ä½“çš„æŠ¤ç†æ¡ˆä¾‹å’Œæ“ä½œç»†èŠ‚ï¼Œä½¿å›ç­”æ›´å…·ä¸“ä¸šæ€§ã€‚';
            } else if (score >= 70) {
                feedbackContent = 'æ‚¨çš„å›ç­”åŸºæœ¬ç¬¦åˆè¦æ±‚ï¼Œä½†ä¸“ä¸šå†…å®¹å¯ä»¥æ›´åŠ ä¸°å¯Œã€‚å»ºè®®å¤šç»“åˆæŠ¤ç†å®è·µç»éªŒå’Œä¸“ä¸šçŸ¥è¯†æ¥å®Œå–„å›ç­”ã€‚';
            } else {
                feedbackContent = 'æ‚¨çš„å›ç­”éœ€è¦è¿›ä¸€æ­¥æ”¹è¿›ã€‚å»ºè®®åŠ å¼ºæŠ¤ç†ä¸“ä¸šçŸ¥è¯†çš„å­¦ä¹ ï¼Œç»“åˆå®é™…æ¡ˆä¾‹æ¥æå‡å›ç­”çš„ä¸“ä¸šæ€§ã€‚';
            }
            
            // é’ˆå¯¹ä¸åŒæŠ¤ç†é¢è¯•ç±»å‹ç»™å‡ºå…·ä½“å»ºè®®
            if (interviewData.type === 'new-graduate') {
                feedbackContent += '\n\nåº”å±Šç”Ÿå»ºè®®ï¼šé‡ç‚¹çªå‡ºå­¦ä¹ èƒ½åŠ›å’Œå®ä¹ ç»éªŒï¼Œå±•ç¤ºå¯¹æŠ¤ç†èŒä¸šçš„çƒ­æƒ…å’Œç†è§£ã€‚';
            } else if (interviewData.type === 'junior-nurse') {
                feedbackContent += '\n\nåˆçº§æŠ¤å£«å»ºè®®ï¼šå¼ºè°ƒå®è·µç»éªŒå’Œå›¢é˜Ÿåä½œèƒ½åŠ›ï¼Œå±•ç¤ºä¸“ä¸šæˆé•¿æ½œåŠ›ã€‚';
            } else if (interviewData.type === 'senior-nurse') {
                feedbackContent += '\n\nèµ„æ·±æŠ¤å£«å»ºè®®ï¼šçªå‡ºé¢†å¯¼èƒ½åŠ›å’Œä¸“ä¸šæŒ‡å¯¼ç»éªŒï¼Œå±•ç¤ºå¯¹æŠ¤ç†è´¨é‡ç®¡ç†çš„è´¡çŒ®ã€‚';
            } else if (interviewData.type === 'specialty') {
                feedbackContent += '\n\nä¸“ç§‘æŠ¤å£«å»ºè®®ï¼šå¼ºè°ƒä¸“ç§‘çŸ¥è¯†å’ŒæŠ€èƒ½ï¼Œå±•ç¤ºä¸“ç§‘æŠ¤ç†çš„ä¸“ä¸šæ·±åº¦ã€‚';
            }
            
            return {
                score: score,
                tags: tags,
                content: feedbackContent
            };
        }

        // è·å–æŠ¤ç†ä¸“ä¸šå…³é”®è¯
        function getNursingKeywords(question) {
            // æŠ¤ç†ä¸“ä¸šå…³é”®è¯æå–
            const keywordMap = {
                'æŠ¤ç†ä¸“ä¸š': ['æŠ¤ç†', 'ä¸“ä¸š', 'æŠ€èƒ½', 'çŸ¥è¯†', 'ä¸´åºŠ'],
                'å®ä¹ ç»å†': ['å®ä¹ ', 'ç»éªŒ', 'å®è·µ', 'ä¸´åºŠ', 'ç—…ä¾‹'],
                'æ‚£è€…æ²Ÿé€š': ['æ‚£è€…', 'æ²Ÿé€š', 'äº¤æµ', 'å€¾å¬', 'å…³æ€€'],
                'å›¢é˜Ÿåä½œ': ['å›¢é˜Ÿ', 'åä½œ', 'åˆä½œ', 'é…åˆ', 'åŒ»ç”Ÿ'],
                'ç´§æ€¥æƒ…å†µ': ['ç´§æ€¥', 'æ€¥æ•‘', 'æŠ¢æ•‘', 'åº”æ€¥', 'å®‰å…¨'],
                'æŠ¤ç†æ“ä½œ': ['æ“ä½œ', 'æŠ€èƒ½', 'è§„èŒƒ', 'å®‰å…¨', 'æµç¨‹'],
                'è´¨é‡ç®¡ç†': ['è´¨é‡', 'ç®¡ç†', 'æ”¹è¿›', 'è¯„ä¼°', 'æ ‡å‡†'],
                'ä¸“ç§‘æŠ¤ç†': ['ä¸“ç§‘', 'ä¸“ä¸š', 'ç‰¹æ®Š', 'ç—…ä¾‹', 'æŠ€æœ¯'],
                'èŒä¸šè§„åˆ’': ['è§„åˆ’', 'å‘å±•', 'ç›®æ ‡', 'æœªæ¥', 'æˆé•¿'],
                'å‹åŠ›å¤„ç†': ['å‹åŠ›', 'åº”å¯¹', 'è°ƒèŠ‚', 'å¿ƒæ€', 'æƒ…ç»ª'],
                'æŠ¤ç†è®°å½•': ['è®°å½•', 'æ–‡æ¡£', 'è¯„ä¼°', 'æŠ¥å‘Š', 'ç—…å†'],
                'æ„ŸæŸ“æ§åˆ¶': ['æ„ŸæŸ“', 'æ§åˆ¶', 'æ¶ˆæ¯’', 'éš”ç¦»', 'é¢„é˜²']
            };
            
            // æŸ¥æ‰¾åŒ¹é…çš„å…³é”®è¯
            for (const [key, keywords] of Object.entries(keywordMap)) {
                if (question.includes(key)) {
                    return keywords;
                }
            }
            
            // é»˜è®¤æŠ¤ç†å…³é”®è¯
            return ['æŠ¤ç†', 'æ‚£è€…', 'ä¸“ä¸š', 'å®‰å…¨', 'æ²Ÿé€š'];
        }

        // ç»Ÿè®¡åŒ¹é…çš„å…³é”®è¯æ•°é‡
        function countMatchedKeywords(answer, keywords) {
            let count = 0;
            for (const keyword of keywords) {
                if (answer.includes(keyword)) {
                    count++;
                }
            }
            return count;
        }

        // æ˜¾ç¤ºåé¦ˆ
        function displayFeedback(feedback) {
            const feedbackElement = document.getElementById('real-time-feedback');
            const currentIndex = interviewData.currentQuestionIndex;
            
            // æ›´æ–°åé¦ˆå†…å®¹
            document.getElementById('feedback-score').textContent = feedback.score;
            
            // æ›´æ–°åé¦ˆæ ‡ç­¾
            const tagsElement = document.getElementById('feedback-tags');
            tagsElement.innerHTML = '';
            for (const tag of feedback.tags) {
                const tagSpan = document.createElement('span');
                tagSpan.className = 'feedback-tag';
                tagSpan.textContent = tag;
                tagsElement.appendChild(tagSpan);
            }
            
            // æ›´æ–°åé¦ˆå†…å®¹
            document.getElementById('feedback-content').textContent = feedback.content;
            
            // æ˜¾ç¤ºåé¦ˆ
            feedbackElement.classList.remove('hidden');
            feedbackElement.classList.add('fade-in');
            
            // ä¿å­˜åé¦ˆåˆ°é¢è¯•æ•°æ®
            if (!interviewData.feedback) {
                interviewData.feedback = [];
            }
            interviewData.feedback[currentIndex] = feedback;
        }

        // å¼€å§‹é¢è¯•
        function startInterviewSession() {
            // åˆå§‹åŒ–é¢è¯•æ•°æ®
            interviewData.startTime = new Date();
            interviewData.currentQuestionIndex = 0;
            interviewData.answers = [];
            
            // æ˜¾ç¤ºé¢è¯•é¡µé¢
            nextStep('step-prepare', 'step-interview');
            
            // ç”Ÿæˆé—®é¢˜
            interviewData.questions = generateQuestions();
            
            // æ˜¾ç¤ºç¬¬ä¸€ä¸ªé—®é¢˜
            displayCurrentQuestion();
            
            // å¼€å§‹è®¡æ—¶
            startTimer();
        }

        // å¼€å§‹è®¡æ—¶
        function startTimer() {
            let seconds = 0;
            const timerElement = document.getElementById('timer');
            const tipElement = document.getElementById('real-time-tip');
            
            const timer = setInterval(() => {
                seconds++;
                const minutes = Math.floor(seconds / 60);
                const remainingSeconds = seconds % 60;
                timerElement.textContent = `${minutes.toString().padStart(2, '0')}:${remainingSeconds.toString().padStart(2, '0')}`;
                
                // å®æ—¶æç¤ºé€»è¾‘
                updateRealTimeTip(seconds);
            }, 1000);
            
            interviewData.timer = timer;
        }

        // æ›´æ–°å®æ—¶æç¤º
        function updateRealTimeTip(seconds) {
            const tipElement = document.getElementById('real-time-tip');
            const answerInput = document.getElementById('answer-input');
            const currentAnswer = answerInput.value;
            
            // æ ¹æ®æ—¶é—´å’Œå›ç­”çŠ¶æ€ç»™å‡ºä¸åŒæç¤º
            if (seconds < 30) {
                tipElement.textContent = 'ğŸ’¡ æç¤ºï¼šè¯·æ”¾æ¾å¿ƒæƒ…ï¼Œå¼€å§‹ç»„ç»‡æ‚¨çš„å›ç­”';
            } else if (seconds < 60) {
                tipElement.textContent = 'â±ï¸ æç¤ºï¼šæ—¶é—´è¿˜å……è£•ï¼Œæ‚¨å¯ä»¥è¯¦ç»†é˜è¿°';
            } else if (seconds < 90) {
                tipElement.textContent = 'â±ï¸ æç¤ºï¼šæ—¶é—´å·²è¿‡ä¸€åŠï¼Œè¯·ç¡®ä¿è¦†ç›–æ ¸å¿ƒè¦ç‚¹';
            } else if (seconds < 120) {
                tipElement.textContent = 'â±ï¸ æç¤ºï¼šæ—¶é—´å‰©ä½™1åˆ†é’Ÿï¼Œå»ºè®®å¼€å§‹æ€»ç»“';
            } else if (seconds < 150) {
                tipElement.textContent = 'â±ï¸ æç¤ºï¼šæ—¶é—´å‰©ä½™30ç§’ï¼Œè¯·ç®€è¦æ€»ç»“æ‚¨çš„å›ç­”';
            } else {
                tipElement.textContent = 'â±ï¸ æç¤ºï¼šæ—¶é—´å³å°†ç»“æŸï¼Œè¯·å°½å¿«å®Œæˆå›ç­”';
            }
            
            // æ ¹æ®å›ç­”é•¿åº¦ç»™å‡ºå»ºè®®
            if (currentAnswer.length < 20 && seconds > 60) {
                tipElement.textContent += ' | ğŸ“ å»ºè®®ï¼šå¯ä»¥è¡¥å……æ›´å¤šç»†èŠ‚';
            } else if (currentAnswer.length > 300) {
                tipElement.textContent += ' | ğŸ“ å»ºè®®ï¼šå¯ä»¥é€‚å½“ç²¾ç®€å†…å®¹';
            }
            
            // æ ¹æ®å›ç­”å†…å®¹ç»™å‡ºå»ºè®®
            if (!currentAnswer.includes('å› ä¸º') && !currentAnswer.includes('æ‰€ä»¥') && !currentAnswer.includes('ä½†æ˜¯') && seconds > 45) {
                tipElement.textContent += ' | ğŸ“ å»ºè®®ï¼šå¯ä»¥ä½¿ç”¨é€»è¾‘è¿æ¥è¯å¢å¼ºè¡¨è¾¾';
            }
        }

        // ç»“æŸé¢è¯•
        function endInterview() {
            // åœæ­¢è®¡æ—¶
            if (interviewData.timer) {
                clearInterval(interviewData.timer);
            }
            
            // ä¿å­˜ç»“æŸæ—¶é—´
            interviewData.endTime = new Date();
            
            // ç”Ÿæˆè¯„åˆ†
            generateScore();
            
            // æ˜¾ç¤ºç»“æœé¡µé¢
            nextStep('step-interview', 'step-result');
            
            // æ˜¾ç¤ºè¯„åˆ†ç»“æœ
            displayResult();
        }

        // ç”Ÿæˆè¯„åˆ†
        function generateScore() {
            // è¿™é‡Œä½¿ç”¨æ¨¡æ‹Ÿè¯„åˆ†ï¼Œå®é™…åº”ç”¨ä¸­å¯ä»¥è°ƒç”¨AI APIè¿›è¡Œè¯„åˆ†
            interviewData.score = Math.floor(Math.random() * 20) + 80; // 80-100åˆ†
            interviewData.details = {
                content: Math.floor(Math.random() * 20) + 80,
                fluency: Math.floor(Math.random() * 20) + 80,
                structure: Math.floor(Math.random() * 20) + 80,
                confidence: Math.floor(Math.random() * 20) + 80
            };
        }

        // æ˜¾ç¤ºç»“æœ
        function displayResult() {
            document.getElementById('total-score').textContent = interviewData.score;
            
            const scoreDetails = document.getElementById('score-details');
            scoreDetails.innerHTML = `
                <p>â€¢ å†…å®¹å®Œæ•´æ€§ï¼š${interviewData.details.content}åˆ†</p>
                <p>â€¢ è¡¨è¾¾æµç•…åº¦ï¼š${interviewData.details.fluency}åˆ†</p>
                <p>â€¢ ç»“æ„æ¸…æ™°åº¦ï¼š${interviewData.details.structure}åˆ†</p>
                <p>â€¢ è‡ªä¿¡ç¨‹åº¦ï¼š${interviewData.details.confidence}åˆ†</p>
            `;
            
            const summary = document.getElementById('interview-summary');
            summary.innerHTML = `
                <p>é¢è¯•ç±»å‹ï¼š${interviewData.type === 'technical' ? 'æŠ€æœ¯é¢è¯•' : interviewData.type === 'hr' ? 'HRé¢è¯•' : interviewData.type === 'behavioral' ? 'è¡Œä¸ºé¢è¯•' : 'å‹åŠ›é¢è¯•'}</p>
                <p>é—®é¢˜æ•°é‡ï¼š${interviewData.questions.length}ä¸ª</p>
                <p>é¢è¯•æ—¶é•¿ï¼š${Math.round((interviewData.endTime - interviewData.startTime) / 1000 / 60)}åˆ†é’Ÿ</p>
                <p>ç»¼åˆè¯„ä»·ï¼š${interviewData.score >= 90 ? 'ä¼˜ç§€' : interviewData.score >= 80 ? 'è‰¯å¥½' : interviewData.score >= 70 ? 'ä¸€èˆ¬' : 'éœ€è¦æ”¹è¿›'}</p>
            `;
        }

        // ç”ŸæˆæŠ¥å‘Š
        function generateReport() {
            nextStep('step-result', 'step-report');
            
            const reportContent = document.getElementById('report-content');
            let reportHTML = `
                <div class="report-item">
                    <div class="report-item-title">ğŸ“‹ é¢è¯•åŸºæœ¬ä¿¡æ¯</div>
                    <div class="report-item-content">
                        <p>â€¢ å§“åï¼š${interviewData.candidate.name || 'æœªå¡«å†™'}</p>
                        <p>â€¢ é‚®ç®±ï¼š${interviewData.candidate.email || 'æœªå¡«å†™'}</p>
                        <p>â€¢ åº”è˜èŒä½ï¼š${interviewData.candidate.position || 'æœªå¡«å†™'}</p>
                        <p>â€¢ é¢è¯•ç±»å‹ï¼š${interviewData.type === 'technical' ? 'æŠ€æœ¯é¢è¯•' : interviewData.type === 'hr' ? 'HRé¢è¯•' : interviewData.type === 'behavioral' ? 'è¡Œä¸ºé¢è¯•' : 'å‹åŠ›é¢è¯•'}</p>
                        <p>â€¢ é¢è¯•æ—¶é—´ï¼š${interviewData.startTime ? interviewData.startTime.toLocaleString() : 'æœªè®°å½•'}</p>
                        <p>â€¢ é¢è¯•æ—¶é•¿ï¼š${interviewData.startTime && interviewData.endTime ? Math.round((interviewData.endTime - interviewData.startTime) / 1000 / 60) + 'åˆ†é’Ÿ' : 'æœªè®°å½•'}</p>
                    </div>
                </div>
                
                <div class="report-item">
                    <div class="report-item-title">ğŸ¯ ç»¼åˆè¯„åˆ†</div>
                    <div class="report-item-content">
                        <p style="font-size: 2rem; font-weight: bold; color: var(--primary-color);">${interviewData.score}</p>
                        <p>å†…å®¹å®Œæ•´æ€§ï¼š${interviewData.details.content}åˆ†</p>
                        <p>è¡¨è¾¾æµç•…åº¦ï¼š${interviewData.details.fluency}åˆ†</p>
                        <p>ç»“æ„æ¸…æ™°åº¦ï¼š${interviewData.details.structure}åˆ†</p>
                        <p>è‡ªä¿¡ç¨‹åº¦ï¼š${interviewData.details.confidence}åˆ†</p>
                        
                        <div style="margin-top: 15px; padding: 10px; background-color: rgba(74, 108, 247, 0.1); border-radius: 8px;">
                            <strong>è¯„åˆ†è¯´æ˜ï¼š</strong>
                            <p style="margin: 5px 0;">90-100åˆ†ï¼šä¼˜ç§€ï¼Œå…·å¤‡å‡ºè‰²çš„é¢è¯•è¡¨ç°å’Œä¸“ä¸šèƒ½åŠ›</p>
                            <p style="margin: 5px 0;">80-89åˆ†ï¼šè‰¯å¥½ï¼Œå…·å¤‡è¾ƒå¼ºçš„é¢è¯•èƒ½åŠ›ï¼Œæœ‰å°å¹…æå‡ç©ºé—´</p>
                            <p style="margin: 5px 0;">70-79åˆ†ï¼šä¸€èˆ¬ï¼ŒåŸºæœ¬ç¬¦åˆè¦æ±‚ï¼Œéœ€è¦è¿›ä¸€æ­¥æå‡</p>
                            <p style="margin: 5px 0;">60-69åˆ†ï¼šåŠæ ¼ï¼Œæœ‰æ˜æ˜¾ä¸è¶³ï¼Œéœ€è¦é’ˆå¯¹æ€§æ”¹è¿›</p>
                            <p style="margin: 5px 0;">60åˆ†ä»¥ä¸‹ï¼šä¸åŠæ ¼ï¼Œå»ºè®®é‡æ–°å‡†å¤‡é¢è¯•</p>
                        </div>
                    </div>
                </div>
                
                <div class="report-item">
                    <div class="report-item-title">âœ¨ ä¸ªäººä¼˜åŠ¿åˆ†æ</div>
                    <div class="report-item-content">
                        ${generateStrengthsAnalysis()}
                    </div>
                </div>
                
                <div class="report-item">
                    <div class="report-item-title">ğŸ“ é—®é¢˜ä¸å›ç­”</div>
                    <div class="report-item-content">
            `;
            
            for (let i = 0; i < interviewData.questions.length; i++) {
                reportHTML += `
                    <div style="margin: 20px 0; padding: 15px; background-color: rgba(74, 108, 247, 0.05); border-radius: 8px;">
                        <p style="margin: 0 0 10px 0;"><strong>é—®é¢˜ ${i + 1}ï¼š</strong>${interviewData.questions[i]}</p>
                        <p style="margin: 0 0 10px 0;"><strong>å›ç­”ï¼š</strong>${interviewData.answers[i] || 'æœªå›ç­”'}</p>
                        ${interviewData.feedback && interviewData.feedback[i] ? `
                        <div style="margin-top: 10px; padding: 10px; background-color: rgba(0, 184, 148, 0.05); border-left: 3px solid var(--success-color); border-radius: 0 8px 8px 0;">
                            <p style="margin: 0 0 5px 0;"><strong>AIåé¦ˆï¼š</strong>è¯„åˆ† ${interviewData.feedback[i].score}</p>
                            <p style="margin: 0;">${interviewData.feedback[i].content}</p>
                        </div>
                        ` : ''}
                    </div>
                `;
            }
            
            reportHTML += `
                    </div>
                </div>
                
                <div class="report-item">
                    <div class="report-item-title">ğŸ¯ èŒä¸šå‘å±•å»ºè®®</div>
                    <div class="report-item-content">
                        ${generateCareerAdvice()}
                    </div>
                </div>
                
                <div class="report-item">
                    <div class="report-item-title">ğŸ“Š è¡Œä¸šè¶‹åŠ¿ä¸å²—ä½è¦æ±‚</div>
                    <div class="report-item-content">
                        ${generateIndustryTrends()}
                    </div>
                </div>
                
                <div class="report-item">
                    <div class="report-item-title">ğŸ’¡ ä¸ªæ€§åŒ–æ”¹è¿›å»ºè®®</div>
                    <div class="report-item-content">
                        ${generateImprovementTips()}
                    </div>
                </div>
                
                <div class="report-item">
                    <div class="report-item-title">ğŸ“š é¢è¯•å‡†å¤‡èµ„æºæ¨è</div>
                    <div class="report-item-content">
                        <p>1. ã€Šé¢è¯•é€šå…³å®æˆ˜ã€‹- å­¦ä¹ é¢è¯•æŠ€å·§å’Œæ¡ˆä¾‹åˆ†æ</p>
                        <p>2. è¡Œä¸šä¸“ä¸šä¹¦ç± - æå‡ä¸“ä¸šçŸ¥è¯†æ·±åº¦</p>
                        <p>3. åœ¨çº¿è¯¾ç¨‹å¹³å°ï¼ˆå¦‚Courseraã€Udemyï¼‰- å­¦ä¹ ç›¸å…³æŠ€èƒ½</p>
                        <p>4. æ¨¡æ‹Ÿé¢è¯•å·¥å…· - å¤šåŠ ç»ƒä¹ ï¼Œç†Ÿèƒ½ç”Ÿå·§</p>
                        <p>5. è¡Œä¸šåšå®¢å’Œå…¬ä¼—å· - äº†è§£æœ€æ–°è¶‹åŠ¿å’ŒåŠ¨æ€</p>
                    </div>
                </div>
            `;
            
            reportContent.innerHTML = reportHTML;
        }
        
        // ç”Ÿæˆä¸ªäººä¼˜åŠ¿åˆ†æ
        function generateStrengthsAnalysis() {
            // åŸºäºé¢è¯•è¡¨ç°ç”Ÿæˆä¼˜åŠ¿åˆ†æ
            const strengths = [];
            
            if (interviewData.details.content >= 85) {
                strengths.push('å†…å®¹å®Œæ•´æ€§å¼ºï¼Œèƒ½å¤Ÿå…¨é¢å›ç­”é—®é¢˜');
            }
            if (interviewData.details.fluency >= 85) {
                strengths.push('è¡¨è¾¾æµç•…ï¼Œè¯­è¨€ç»„ç»‡èƒ½åŠ›å¼º');
            }
            if (interviewData.details.structure >= 85) {
                strengths.push('å›ç­”ç»“æ„æ¸…æ™°ï¼Œé€»è¾‘æ€ç»´èƒ½åŠ›å¼º');
            }
            if (interviewData.details.confidence >= 85) {
                strengths.push('è‡ªä¿¡å¿ƒå¼ºï¼Œèƒ½å¤Ÿä»å®¹åº”å¯¹é¢è¯•');
            }
            
            // æ·»åŠ é€šç”¨ä¼˜åŠ¿
            strengths.push('ç§¯æå‚ä¸é¢è¯•ï¼Œæ€åº¦è®¤çœŸ');
            strengths.push('å…·å¤‡åŸºæœ¬çš„é¢è¯•æŠ€å·§å’Œç¤¼ä»ª');
            
            let strengthsHTML = '';
            strengths.forEach((strength, index) => {
                strengthsHTML += `<p>${index + 1}. ${strength}</p>`;
            });
            
            return strengthsHTML;
        }
        
        // ç”ŸæˆèŒä¸šå‘å±•å»ºè®®
        function generateCareerAdvice() {
            const position = interviewData.candidate.position || 'æœªçŸ¥èŒä½';
            let advice = '';
            
            // åŸºäºé¢è¯•ç±»å‹å’ŒèŒä½ç»™å‡ºå»ºè®®
            if (interviewData.type === 'technical') {
                advice += `<p>1. æ·±å…¥å­¦ä¹ ä¸“ä¸šæŠ€æœ¯çŸ¥è¯†ï¼Œå°¤å…¶æ˜¯é¢è¯•ä¸­æ¶‰åŠçš„æ ¸å¿ƒæ¦‚å¿µ</p>`;
                advice += `<p>2. å¤šåšé¡¹ç›®å®è·µï¼Œç§¯ç´¯å®é™…å¼€å‘ç»éªŒ</p>`;
                advice += `<p>3. å­¦ä¹ æ–°æŠ€æœ¯æ ˆï¼Œå…³æ³¨è¡Œä¸šå‘å±•è¶‹åŠ¿</p>`;
                advice += `<p>4. å‚ä¸å¼€æºé¡¹ç›®ï¼Œæå‡æŠ€æœ¯å½±å“åŠ›</p>`;
            } else if (interviewData.type === 'hr') {
                advice += `<p>1. æ˜ç¡®èŒä¸šè§„åˆ’ï¼Œäº†è§£è‡ªèº«ä¼˜åŠ¿å’Œå®šä½</p>`;
                advice += `<p>2. æå‡æ²Ÿé€šèƒ½åŠ›å’Œå›¢é˜Ÿåˆä½œèƒ½åŠ›</p>`;
                advice += `<p>3. å­¦ä¹ èŒåœºç¤¼ä»ªå’Œäººé™…å…³ç³»å¤„ç†æŠ€å·§</p>`;
                advice += `<p>4. äº†è§£ä¼ä¸šæ–‡åŒ–ï¼Œå¯»æ‰¾åŒ¹é…åº¦é«˜çš„å…¬å¸</p>`;
            } else if (interviewData.type === 'behavioral') {
                advice += `<p>1. æ€»ç»“è¿‡å¾€ç»å†ï¼Œæç‚¼å…³é”®æˆå°±å’Œç»éªŒ</p>`;
                advice += `<p>2. å­¦ä¹ STARæ³•åˆ™ï¼Œæå‡æ•…äº‹è®²è¿°èƒ½åŠ›</p>`;
                advice += `<p>3. åŸ¹å…»è§£å†³é—®é¢˜å’Œåº”å¯¹æŒ‘æˆ˜çš„èƒ½åŠ›</p>`;
                advice += `<p>4. æå‡æƒ…ç»ªç®¡ç†å’Œå‹åŠ›åº”å¯¹èƒ½åŠ›</p>`;
            } else {
                advice += `<p>1. æå‡æŠ—å‹èƒ½åŠ›ï¼Œå­¦ä¹ æƒ…ç»ªè°ƒèŠ‚æŠ€å·§</p>`;
                advice += `<p>2. åŸ¹å…»å¿«é€Ÿæ€è€ƒå’Œåº”å˜èƒ½åŠ›</p>`;
                advice += `<p>3. å­¦ä¹ è°ˆåˆ¤æŠ€å·§å’Œè‡ªä¿¡å¿ƒæå‡æ–¹æ³•</p>`;
                advice += `<p>4. æå‰å‡†å¤‡å¯èƒ½çš„å‹åŠ›é—®é¢˜ï¼Œåšå¥½åº”å¯¹ç­–ç•¥</p>`;
            }
            
            advice += `<p>5. å»ºç«‹èŒä¸šäººè„‰ï¼Œå‚ä¸è¡Œä¸šæ´»åŠ¨å’Œç¤¾ç¾¤</p>`;
            advice += `<p>6. å®šæœŸè¯„ä¼°èŒä¸šå‘å±•ï¼Œè°ƒæ•´è§„åˆ’å’Œç›®æ ‡</p>`;
            
            return advice;
        }
        
        // ç”Ÿæˆè¡Œä¸šè¶‹åŠ¿åˆ†æ
        function generateIndustryTrends() {
            let trends = '';
            
            trends += `<p>1. æ•°å­—åŒ–è½¬å‹åŠ é€Ÿï¼Œç›¸å…³æŠ€æœ¯äººæ‰éœ€æ±‚æŒç»­å¢é•¿</p>`;
            trends += `<p>2. äººå·¥æ™ºèƒ½å’Œå¤§æ•°æ®æŠ€æœ¯å¹¿æ³›åº”ç”¨ï¼Œå¤åˆå‹äººæ‰å—æ¬¢è¿</p>`;
            trends += `<p>3. è¿œç¨‹å·¥ä½œå’Œçµæ´»å°±ä¸šæˆä¸ºå¸¸æ€ï¼Œé€‚åº”æ€§å¼ºçš„äººæ‰æ›´å…·ä¼˜åŠ¿</p>`;
            trends += `<p>4. è¡Œä¸šç«äº‰åŠ å‰§ï¼ŒæŒç»­å­¦ä¹ å’Œè‡ªæˆ‘æå‡èƒ½åŠ›æˆä¸ºæ ¸å¿ƒç«äº‰åŠ›</p>`;
            trends += `<p>5. è½¯æŠ€èƒ½ï¼ˆæ²Ÿé€šã€åä½œã€åˆ›æ–°ï¼‰çš„é‡è¦æ€§æ—¥ç›Šå‡¸æ˜¾</p>`;
            
            return trends;
        }
        
        // ç”Ÿæˆä¸ªæ€§åŒ–æ”¹è¿›å»ºè®®
        function generateImprovementTips() {
            let tips = '';
            
            // åŸºäºè¯„åˆ†ç»™å‡ºé’ˆå¯¹æ€§å»ºè®®
            if (interviewData.details.content < 80) {
                tips += `<p>1. å›ç­”é—®é¢˜æ—¶æ³¨æ„å†…å®¹å®Œæ•´æ€§ï¼Œç¡®ä¿è¦†ç›–æ‰€æœ‰å…³é”®ç‚¹</p>`;
                tips += `<p>2. æå‰å‡†å¤‡å¸¸è§é—®é¢˜ï¼Œé¿å…å›ç­”è¿‡äºç®€ç•¥</p>`;
            }
            if (interviewData.details.fluency < 80) {
                tips += `<p>3. å¤šç»ƒä¹ å£è¯­è¡¨è¾¾ï¼Œæé«˜è¯­è¨€æµç•…åº¦</p>`;
                tips += `<p>4. æ”¾æ…¢è¯­é€Ÿï¼Œæ¸…æ™°è¡¨è¾¾æ¯ä¸€ä¸ªè§‚ç‚¹</p>`;
            }
            if (interviewData.details.structure < 80) {
                tips += `<p>5. å­¦ä¹ ç»“æ„åŒ–æ€è€ƒï¼Œä½¿ç”¨é€»è¾‘è¿æ¥è¯ç»„ç»‡å†…å®¹</p>`;
                tips += `<p>6. é‡‡ç”¨æ€»åˆ†æ€»ç»“æ„ï¼Œå…ˆæ¦‚æ‹¬åå±•å¼€å†æ€»ç»“</p>`;
            }
            if (interviewData.details.confidence < 80) {
                tips += `<p>7. å¢å¼ºè‡ªä¿¡å¿ƒï¼Œé€šè¿‡æ¨¡æ‹Ÿé¢è¯•æé«˜åº”å¯¹èƒ½åŠ›</p>`;
                tips += `<p>8. ä¿æŒè‰¯å¥½çš„ä½“æ€å’Œçœ¼ç¥äº¤æµï¼Œå±•ç°è‡ªä¿¡å½¢è±¡</p>`;
            }
            
            // æ·»åŠ é€šç”¨å»ºè®®
            tips += `<p>9. ç ”ç©¶ç›®æ ‡å…¬å¸å’Œå²—ä½ï¼Œäº†è§£å…·ä½“è¦æ±‚å’Œä¼ä¸šæ–‡åŒ–</p>`;
            tips += `<p>10. å‡†å¤‡å¥½è‡ªå·±çš„é—®é¢˜ï¼Œå±•ç°å¯¹å…¬å¸çš„å…´è¶£å’Œæ€è€ƒ</p>`;
            
            return tips;
        }

        // ä¸‹è½½æŠ¥å‘Š
        function downloadReport() {
            // ç”ŸæˆæŠ¥å‘Šæ–‡æœ¬
            let reportText = `AIé¢è¯•æŠ¥å‘Š\n`;
            reportText += `============================\n\n`;
            reportText += `åŸºæœ¬ä¿¡æ¯\n`;
            reportText += `å§“åï¼š${interviewData.candidate.name || 'æœªå¡«å†™'}\n`;
            reportText += `é‚®ç®±ï¼š${interviewData.candidate.email || 'æœªå¡«å†™'}\n`;
            reportText += `åº”è˜èŒä½ï¼š${interviewData.candidate.position || 'æœªå¡«å†™'}\n`;
            reportText += `é¢è¯•ç±»å‹ï¼š${interviewData.type === 'technical' ? 'æŠ€æœ¯é¢è¯•' : interviewData.type === 'hr' ? 'HRé¢è¯•' : interviewData.type === 'behavioral' ? 'è¡Œä¸ºé¢è¯•' : 'å‹åŠ›é¢è¯•'}\n`;
            reportText += `é¢è¯•æ—¶é—´ï¼š${interviewData.startTime ? interviewData.startTime.toLocaleString() : 'æœªè®°å½•'}\n`;
            reportText += `é¢è¯•æ—¶é•¿ï¼š${interviewData.startTime && interviewData.endTime ? Math.round((interviewData.endTime - interviewData.startTime) / 1000 / 60) + 'åˆ†é’Ÿ' : 'æœªè®°å½•'}\n\n`;
            
            reportText += `è¯„åˆ†ç»“æœ\n`;
            reportText += `ç»¼åˆè¯„åˆ†ï¼š${interviewData.score}\n`;
            reportText += `å†…å®¹å®Œæ•´æ€§ï¼š${interviewData.details.content}åˆ†\n`;
            reportText += `è¡¨è¾¾æµç•…åº¦ï¼š${interviewData.details.fluency}åˆ†\n`;
            reportText += `ç»“æ„æ¸…æ™°åº¦ï¼š${interviewData.details.structure}åˆ†\n`;
            reportText += `è‡ªä¿¡ç¨‹åº¦ï¼š${interviewData.details.confidence}åˆ†\n\n`;
            
            reportText += `é—®é¢˜ä¸å›ç­”\n`;
            for (let i = 0; i < interviewData.questions.length; i++) {
                reportText += `é—®é¢˜ ${i + 1}ï¼š${interviewData.questions[i]}\n`;
                reportText += `å›ç­”ï¼š${interviewData.answers[i] || 'æœªå›ç­”'}\n\n`;
            }
            
            reportText += `æ”¹è¿›å»ºè®®\n`;
            reportText += `1. å»ºè®®åœ¨å›ç­”é—®é¢˜æ—¶æ›´åŠ ç»“æ„åŒ–ï¼Œä½¿ç”¨STARæ³•åˆ™ï¼ˆæƒ…å¢ƒã€ä»»åŠ¡ã€è¡ŒåŠ¨ã€ç»“æœï¼‰\n`;
            reportText += `2. å¯ä»¥é€‚å½“å¢åŠ ä¸€äº›å…·ä½“çš„æ¡ˆä¾‹æ¥æ”¯æŒä½ çš„è§‚ç‚¹\n`;
            reportText += `3. æ³¨æ„æ§åˆ¶å›ç­”æ—¶é—´ï¼Œé¿å…è¿‡é•¿æˆ–è¿‡çŸ­\n`;
            reportText += `4. ä¿æŒè‡ªä¿¡çš„è¯­æ°”å’Œç§¯æçš„æ€åº¦\n`;
            reportText += `5. æå‰å‡†å¤‡å¸¸è§é¢è¯•é—®é¢˜ï¼Œåšåˆ°å¿ƒä¸­æœ‰æ•°\n\n`;
            
            reportText += `æŠ¥å‘Šç”Ÿæˆæ—¶é—´ï¼š${new Date().toLocaleString()}`;
            
            // åˆ›å»ºä¸‹è½½é“¾æ¥
            const blob = new Blob([reportText], { type: 'text/plain;charset=utf-8' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = `AIé¢è¯•æŠ¥å‘Š_${interviewData.type}_${new Date().toISOString().slice(0, 10)}.txt`;
            link.click();
            URL.revokeObjectURL(link.href);
        }

        // ç”ŸæˆæŠ¥å‘Šå›¾ç‰‡
        async function generateReportImage() {
            try {
                // åˆ›å»ºCanvaså…ƒç´ 
                const canvas = document.createElement('canvas');
                const ctx = canvas.getContext('2d');
                
                // è®¾ç½®ç”»å¸ƒå°ºå¯¸ï¼ˆA4çº¸æ¯”ä¾‹ï¼‰
                canvas.width = 800;
                canvas.height = 1120;
                
                // å¡«å……èƒŒæ™¯è‰²
                ctx.fillStyle = '#ffffff';
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                
                // ç»˜åˆ¶æ ‡é¢˜
                ctx.fillStyle = '#2d3436';
                ctx.font = 'bold 28px Arial';
                ctx.textAlign = 'center';
                ctx.fillText('æŠ¤å£«å²—ä½AIé¢è¯•åˆ†ææŠ¥å‘Š', canvas.width / 2, 60);
                
                // ç»˜åˆ¶åŸºæœ¬ä¿¡æ¯
                ctx.font = '16px Arial';
                ctx.textAlign = 'left';
                let yPos = 120;
                
                // åŸºæœ¬ä¿¡æ¯åŒºå—
                ctx.fillStyle = '#4a6cf7';
                ctx.font = 'bold 18px Arial';
                ctx.fillText('ğŸ“‹ åŸºæœ¬ä¿¡æ¯', 40, yPos);
                
                ctx.fillStyle = '#2d3436';
                ctx.font = '14px Arial';
                yPos += 30;
                
                const basicInfo = [
                    `å§“åï¼š${interviewData.candidate.name || 'æœªå¡«å†™'}`,
                    `åº”è˜èŒä½ï¼š${interviewData.candidate.position || 'æœªå¡«å†™'}`,
                    `é¢è¯•ç±»å‹ï¼š${getNursingInterviewTypeName(interviewData.type)}`,
                    `é¢è¯•æ—¶é—´ï¼š${interviewData.startTime ? interviewData.startTime.toLocaleString() : 'æœªè®°å½•'}`,
                    `é¢è¯•æ—¶é•¿ï¼š${interviewData.startTime && interviewData.endTime ? Math.round((interviewData.endTime - interviewData.startTime) / 1000 / 60) + 'åˆ†é’Ÿ' : 'æœªè®°å½•'}`
                ];
                
                basicInfo.forEach(info => {
                    ctx.fillText(info, 50, yPos);
                    yPos += 25;
                });
                
                // ç»˜åˆ¶è¯„åˆ†åŒºå—
                yPos += 20;
                ctx.fillStyle = '#4a6cf7';
                ctx.font = 'bold 18px Arial';
                ctx.fillText('ğŸ¯ ç»¼åˆè¯„åˆ†', 40, yPos);
                
                // ç»˜åˆ¶è¯„åˆ†åœ†ç¯
                yPos += 60;
                const centerX = canvas.width / 2;
                const radius = 50;
                
                // èƒŒæ™¯åœ†ç¯
                ctx.beginPath();
                ctx.arc(centerX, yPos, radius, 0, Math.PI * 2);
                ctx.strokeStyle = '#dfe6e9';
                ctx.lineWidth = 8;
                ctx.stroke();
                
                // åˆ†æ•°åœ†ç¯
                const scoreRatio = interviewData.score / 100;
                ctx.beginPath();
                ctx.arc(centerX, yPos, radius, -Math.PI / 2, -Math.PI / 2 + Math.PI * 2 * scoreRatio);
                ctx.strokeStyle = getScoreColor(interviewData.score);
                ctx.lineWidth = 8;
                ctx.stroke();
                
                // åˆ†æ•°æ–‡å­—
                ctx.fillStyle = getScoreColor(interviewData.score);
                ctx.font = 'bold 24px Arial';
                ctx.textAlign = 'center';
                ctx.fillText(interviewData.score.toString(), centerX, yPos + 8);
                
                ctx.textAlign = 'left';
                
                // è¯¦ç»†è¯„åˆ†
                yPos += 80;
                const details = [
                    `å†…å®¹å®Œæ•´æ€§ï¼š${interviewData.details.content}åˆ†`,
                    `è¡¨è¾¾æµç•…åº¦ï¼š${interviewData.details.fluency}åˆ†`,
                    `ç»“æ„æ¸…æ™°åº¦ï¼š${interviewData.details.structure}åˆ†`,
                    `è‡ªä¿¡ç¨‹åº¦ï¼š${interviewData.details.confidence}åˆ†`
                ];
                
                details.forEach((detail, index) => {
                    ctx.fillStyle = '#2d3436';
                    ctx.font = '14px Arial';
                    ctx.fillText(detail, 50, yPos + index * 25);
                });
                
                // ç»˜åˆ¶è¯„ä»·ç­‰çº§
                yPos += 120;
                ctx.fillStyle = '#4a6cf7';
                ctx.font = 'bold 18px Arial';
                ctx.fillText('âœ¨ ç»¼åˆè¯„ä»·', 40, yPos);
                
                yPos += 30;
                ctx.fillStyle = getScoreColor(interviewData.score);
                ctx.font = 'bold 20px Arial';
                ctx.fillText(getScoreLevel(interviewData.score), 50, yPos);
                
                // ç»˜åˆ¶ä¸ªäººä¼˜åŠ¿
                yPos += 40;
                ctx.fillStyle = '#4a6cf7';
                ctx.font = 'bold 18px Arial';
                ctx.fillText('ğŸ† ä¸ªäººä¼˜åŠ¿', 40, yPos);
                
                yPos += 30;
                ctx.fillStyle = '#2d3436';
                ctx.font = '14px Arial';
                const strengths = generateStrengthsForImage();
                strengths.forEach((strength, index) => {
                    if (yPos + index * 20 < canvas.height - 100) {
                        ctx.fillText(`â€¢ ${strength}`, 50, yPos + index * 20);
                    }
                });
                
                // ç»˜åˆ¶æ”¹è¿›å»ºè®®
                yPos += strengths.length * 20 + 20;
                if (yPos < canvas.height - 100) {
                    ctx.fillStyle = '#4a6cf7';
                    ctx.font = 'bold 18px Arial';
                    ctx.fillText('ğŸ’¡ æ”¹è¿›å»ºè®®', 40, yPos);
                    
                    yPos += 30;
                    ctx.fillStyle = '#2d3436';
                    ctx.font = '14px Arial';
                    const suggestions = generateSuggestionsForImage();
                    suggestions.forEach((suggestion, index) => {
                        if (yPos + index * 20 < canvas.height - 50) {
                            ctx.fillText(`â€¢ ${suggestion}`, 50, yPos + index * 20);
                        }
                    });
                }
                
                // ç»˜åˆ¶åº•éƒ¨ä¿¡æ¯
                ctx.fillStyle = '#636e72';
                ctx.font = '12px Arial';
                ctx.textAlign = 'center';
                ctx.fillText('æŠ¤å£«å²—ä½AIé¢è¯•ç³»ç»Ÿ - ä¸“ä¸šæŠ¤ç†é¢è¯•è¯„ä¼°', canvas.width / 2, canvas.height - 30);
                ctx.fillText(`æŠ¥å‘Šç”Ÿæˆæ—¶é—´ï¼š${new Date().toLocaleString()}`, canvas.width / 2, canvas.height - 10);
                
                return canvas.toDataURL('image/png');
                
            } catch (error) {
                console.error('ç”ŸæˆæŠ¥å‘Šå›¾ç‰‡å¤±è´¥:', error);
                // è¿”å›é»˜è®¤å›¾ç‰‡æˆ–é”™è¯¯å¤„ç†
                return null;
            }
        }
        
        // è·å–è¯„åˆ†é¢œè‰²
        function getScoreColor(score) {
            if (score >= 90) return '#00b894';
            if (score >= 80) return '#00cec9';
            if (score >= 70) return '#fdcb6e';
            return '#e17055';
        }
        
        // è·å–è¯„åˆ†ç­‰çº§
        function getScoreLevel(score) {
            if (score >= 90) return 'ä¼˜ç§€ - å…·å¤‡å‡ºè‰²çš„æŠ¤ç†ä¸“ä¸šèƒ½åŠ›';
            if (score >= 80) return 'è‰¯å¥½ - å…·æœ‰è¾ƒå¼ºçš„æŠ¤ç†ä¸“ä¸šç´ å…»';
            if (score >= 70) return 'ä¸€èˆ¬ - åŸºæœ¬ç¬¦åˆæŠ¤ç†å²—ä½è¦æ±‚';
            return 'éœ€è¦æ”¹è¿› - å»ºè®®åŠ å¼ºæŠ¤ç†ä¸“ä¸šçŸ¥è¯†å­¦ä¹ ';
        }
        
        // ç”Ÿæˆå›¾ç‰‡ç”¨çš„ä¸ªäººä¼˜åŠ¿
        function generateStrengthsForImage() {
            const strengths = [];
            
            if (interviewData.details.content >= 85) {
                strengths.push('æŠ¤ç†ä¸“ä¸šçŸ¥è¯†æŒæ¡æ‰å®');
            }
            if (interviewData.details.fluency >= 85) {
                strengths.push('è¯­è¨€è¡¨è¾¾æµç•…è‡ªç„¶');
            }
            if (interviewData.details.structure >= 85) {
                strengths.push('é€»è¾‘æ€ç»´æ¸…æ™°æœ‰åº');
            }
            if (interviewData.details.confidence >= 85) {
                strengths.push('è‡ªä¿¡å¿ƒå¼ºï¼Œåº”å¯¹ä»å®¹');
            }
            
            // ç¡®ä¿è‡³å°‘æœ‰3ä¸ªä¼˜åŠ¿
            if (strengths.length < 3) {
                strengths.push('å­¦ä¹ æ€åº¦è®¤çœŸç§¯æ');
                strengths.push('å…·å¤‡è‰¯å¥½çš„æ²Ÿé€šèƒ½åŠ›');
                strengths.push('èŒä¸šå‘å±•æ½œåŠ›è‰¯å¥½');
            }
            
            return strengths.slice(0, 4); // æœ€å¤šæ˜¾ç¤º4ä¸ªä¼˜åŠ¿
        }
        
        // ç”Ÿæˆå›¾ç‰‡ç”¨çš„æ”¹è¿›å»ºè®®
        function generateSuggestionsForImage() {
            const suggestions = [];
            
            if (interviewData.details.content < 80) {
                suggestions.push('åŠ å¼ºæŠ¤ç†ä¸“ä¸šçŸ¥è¯†æ·±åº¦å’Œå¹¿åº¦');
            }
            if (interviewData.details.fluency < 80) {
                suggestions.push('æå‡è¯­è¨€è¡¨è¾¾çš„æµç•…åº¦å’Œæ¡ç†æ€§');
            }
            if (interviewData.details.structure < 80) {
                suggestions.push('å­¦ä¹ ç»“æ„åŒ–æ€è€ƒï¼Œä½¿ç”¨é€»è¾‘æ¡†æ¶');
            }
            if (interviewData.details.confidence < 80) {
                suggestions.push('å¢å¼ºè‡ªä¿¡å¿ƒï¼Œå¤šè¿›è¡Œæ¨¡æ‹Ÿç»ƒä¹ ');
            }
            
            // é€šç”¨å»ºè®®
            suggestions.push('å¤šå‚ä¸æŠ¤ç†å®è·µï¼Œç§¯ç´¯ä¸´åºŠç»éªŒ');
            suggestions.push('å…³æ³¨æŠ¤ç†è¡Œä¸šåŠ¨æ€å’ŒæŠ€æœ¯å‘å±•');
            
            return suggestions.slice(0, 5); // æœ€å¤šæ˜¾ç¤º5ä¸ªå»ºè®®
        }

        // ä¸‹è½½æŠ¥å‘Šå›¾ç‰‡
        async function downloadReportImage() {
            try {
                // æ˜¾ç¤ºç”Ÿæˆè¿›åº¦
                const originalButton = document.querySelector('button[onclick="downloadReportImage()"]');
                const originalText = originalButton.textContent;
                originalButton.innerHTML = '<span>ğŸ”„ ç”Ÿæˆå›¾ç‰‡ä¸­...</span>';
                originalButton.disabled = true;
                
                // ç”ŸæˆæŠ¥å‘Šå›¾ç‰‡
                const imageDataUrl = await generateReportImage();
                
                if (imageDataUrl) {
                    // åˆ›å»ºä¸‹è½½é“¾æ¥
                    const link = document.createElement('a');
                    link.href = imageDataUrl;
                    link.download = `æŠ¤å£«å²—ä½AIé¢è¯•æŠ¥å‘Š_${interviewData.candidate.name || 'åŒ¿å'}_${new Date().toISOString().slice(0, 10)}.png`;
                    link.click();
                    
                    // æ¢å¤æŒ‰é’®çŠ¶æ€
                    originalButton.innerHTML = originalText;
                    originalButton.disabled = false;
                    
                    // æ˜¾ç¤ºæˆåŠŸæç¤º
                    alert('æŠ¥å‘Šå›¾ç‰‡å·²æˆåŠŸç”Ÿæˆå¹¶ä¸‹è½½ï¼');
                } else {
                    throw new Error('å›¾ç‰‡ç”Ÿæˆå¤±è´¥');
                }
                
            } catch (error) {
                console.error('ä¸‹è½½æŠ¥å‘Šå›¾ç‰‡å¤±è´¥:', error);
                
                // æ¢å¤æŒ‰é’®çŠ¶æ€
                const originalButton = document.querySelector('button[onclick="downloadReportImage()"]');
                originalButton.innerHTML = '<span>ä¸‹è½½æŠ¥å‘Šå›¾ç‰‡</span>';
                originalButton.disabled = false;
                
                // æ˜¾ç¤ºé”™è¯¯æç¤º
                alert('æŠ¥å‘Šå›¾ç‰‡ç”Ÿæˆå¤±è´¥ï¼Œè¯·é‡è¯•æˆ–è”ç³»æŠ€æœ¯æ”¯æŒ');
            }
        }

        // åˆ†äº«é¢è¯•ç»“æœ
        function shareResults() {
            const shareText = `ğŸ¯ æŠ¤å£«å²—ä½AIé¢è¯•ç»“æœ

ğŸ‘¤ å§“åï¼š${interviewData.candidate.name || 'æœªå¡«å†™'}
ğŸ¥ åº”è˜èŒä½ï¼š${interviewData.candidate.position || 'æœªå¡«å†™'}
ğŸ’¯ ç»¼åˆè¯„åˆ†ï¼š${interviewData.score}åˆ†
â±ï¸ é¢è¯•æ—¶é•¿ï¼š${interviewData.startTime && interviewData.endTime ? Math.round((interviewData.endTime - interviewData.startTime) / 1000 / 60) + 'åˆ†é’Ÿ' : 'æœªè®°å½•'}

âœ¨ è¯¦ç»†è¯„åˆ†ï¼š
â€¢ å†…å®¹å®Œæ•´æ€§ï¼š${interviewData.details.content}åˆ†
â€¢ è¡¨è¾¾æµç•…åº¦ï¼š${interviewData.details.fluency}åˆ†
â€¢ ç»“æ„æ¸…æ™°åº¦ï¼š${interviewData.details.structure}åˆ†
â€¢ è‡ªä¿¡ç¨‹åº¦ï¼š${interviewData.details.confidence}åˆ†

ğŸ“Š ç»¼åˆè¯„ä»·ï¼š${interviewData.score >= 90 ? 'ä¼˜ç§€' : interviewData.score >= 80 ? 'è‰¯å¥½' : interviewData.score >= 70 ? 'ä¸€èˆ¬' : 'éœ€è¦æ”¹è¿›'}

ğŸ’¡ ä½¿ç”¨æŠ¤å£«å²—ä½AIé¢è¯•ç³»ç»Ÿï¼Œæå‡æ‚¨çš„æŠ¤ç†é¢è¯•èƒ½åŠ›ï¼

åˆ†äº«æ—¶é—´ï¼š${new Date().toLocaleString()}`;

            // æ£€æŸ¥æ˜¯å¦æ”¯æŒWeb Share API
            if (navigator.share) {
                navigator.share({
                    title: 'æŠ¤å£«å²—ä½AIé¢è¯•ç»“æœ',
                    text: shareText,
                    url: window.location.href
                }).then(() => {
                    console.log('åˆ†äº«æˆåŠŸ');
                }).catch((error) => {
                    console.log('åˆ†äº«å–æ¶ˆæˆ–å¤±è´¥:', error);
                    fallbackShare(shareText);
                });
            } else {
                // å¤‡ç”¨åˆ†äº«æ–¹å¼
                fallbackShare(shareText);
            }
        }

        // å¤‡ç”¨åˆ†äº«æ–¹å¼
        function fallbackShare(text) {
            // å¤åˆ¶åˆ°å‰ªè´´æ¿
            navigator.clipboard.writeText(text).then(() => {
                alert('é¢è¯•ç»“æœå·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼\n\næ‚¨å¯ä»¥ç²˜è´´åˆ°å¾®ä¿¡ã€QQç­‰åº”ç”¨è¿›è¡Œåˆ†äº«ã€‚');
            }).catch(() => {
                // å¦‚æœå¤åˆ¶å¤±è´¥ï¼Œæ˜¾ç¤ºæ–‡æœ¬ä¾›æ‰‹åŠ¨å¤åˆ¶
                const shareText = prompt('è¯·å¤åˆ¶ä»¥ä¸‹å†…å®¹è¿›è¡Œåˆ†äº«ï¼š', text);
                if (shareText) {
                    alert('åˆ†äº«å†…å®¹å·²å‡†å¤‡å¥½ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶åˆ†äº«ã€‚');
                }
            });
        }

        // ç”ŸæˆäºŒç»´ç 
        function generateQRCode() {
            const currentUrl = window.location.href;
            
            // åˆ›å»ºäºŒç»´ç å®¹å™¨
            const qrModal = document.createElement('div');
            qrModal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0,0,0,0.8);
                display: flex;
                justify-content: center;
                align-items: center;
                z-index: 1000;
            `;
            
            const qrContent = document.createElement('div');
            qrContent.style.cssText = `
                background: white;
                padding: 30px;
                border-radius: 15px;
                text-align: center;
                max-width: 300px;
            `;
            
            qrContent.innerHTML = `
                <h3 style="margin-bottom: 20px; color: #333;">å¾®ä¿¡åˆ†äº«äºŒç»´ç </h3>
                <div id="qrcode" style="margin: 20px auto; width: 200px; height: 200px;"></div>
                <p style="color: #666; font-size: 14px; margin: 10px 0;">ä½¿ç”¨å¾®ä¿¡æ‰«æäºŒç»´ç è®¿é—®</p>
                <p style="color: #999; font-size: 12px; margin: 5px 0;">æˆ–å¤åˆ¶é“¾æ¥ï¼š${currentUrl}</p>
                <div style="margin-top: 20px;">
                    <button onclick="copyToClipboard('${currentUrl}')" style="
                        background: #4a6cf7;
                        color: white;
                        border: none;
                        padding: 10px 20px;
                        border-radius: 5px;
                        cursor: pointer;
                        margin: 5px;
                    ">å¤åˆ¶é“¾æ¥</button>
                    <button onclick="this.parentElement.parentElement.parentElement.remove()" style="
                        background: #999;
                        color: white;
                        border: none;
                        padding: 10px 20px;
                        border-radius: 5px;
                        cursor: pointer;
                        margin: 5px;
                    ">å…³é—­</button>
                </div>
            `;
            
            qrModal.appendChild(qrContent);
            document.body.appendChild(qrModal);
            
            // ä½¿ç”¨åœ¨çº¿APIç”ŸæˆäºŒç»´ç 
            const qrImg = document.createElement('img');
            qrImg.src = `https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=${encodeURIComponent(currentUrl)}`;
            qrImg.alt = 'å¾®ä¿¡åˆ†äº«äºŒç»´ç ';
            qrImg.style.width = '200px';
            qrImg.style.height = '200px';
            
            document.getElementById('qrcode').appendChild(qrImg);
            
            // ç‚¹å‡»å¤–éƒ¨å…³é—­
            qrModal.addEventListener('click', (e) => {
                if (e.target === qrModal) {
                    qrModal.remove();
                }
            });
        }

        // å¤åˆ¶åˆ°å‰ªè´´æ¿
        function copyToClipboard(text) {
            navigator.clipboard.writeText(text).then(() => {
                alert('é“¾æ¥å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼');
            }).catch(() => {
                prompt('è¯·æ‰‹åŠ¨å¤åˆ¶é“¾æ¥ï¼š', text);
            });
        }

        // é¢„è§ˆæŠ¥å‘Šå›¾ç‰‡
        async function previewReportImage() {
            try {
                const previewContainer = document.getElementById('report-preview-container');
                const previewContent = document.getElementById('report-preview-content');
                
                // æ˜¾ç¤ºç”ŸæˆçŠ¶æ€
                previewContent.innerHTML = '<p>ğŸ”„ æ­£åœ¨ç”ŸæˆæŠ¥å‘Šå›¾ç‰‡...</p>';
                
                // ç”ŸæˆæŠ¥å‘Šå›¾ç‰‡
                const imageDataUrl = await generateReportImage();
                
                if (imageDataUrl) {
                    // åˆ›å»ºå›¾ç‰‡é¢„è§ˆ
                    previewContent.innerHTML = `
                        <div style="text-align: center;">
                            <img src="${imageDataUrl}" alt="AIé¢è¯•åˆ†ææŠ¥å‘Š" style="max-width: 100%; max-height: 300px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
                            <p style="margin-top: 10px; color: #636e72; font-size: 14px;">æŠ¥å‘Šé¢„è§ˆç”ŸæˆæˆåŠŸï¼ç‚¹å‡»ä¸‹è½½è·å–é«˜æ¸…ç‰ˆæœ¬</p>
                        </div>
                    `;
                    
                    // æ·»åŠ ç‚¹å‡»æ”¾å¤§åŠŸèƒ½
                    const previewImg = previewContent.querySelector('img');
                    previewImg.style.cursor = 'zoom-in';
                    previewImg.onclick = function() {
                        showFullscreenImage(imageDataUrl);
                    };
                    
                } else {
                    previewContent.innerHTML = '<p style="color: #e17055;">âŒ æŠ¥å‘Šå›¾ç‰‡ç”Ÿæˆå¤±è´¥ï¼Œè¯·é‡è¯•</p>';
                }
                
            } catch (error) {
                console.error('é¢„è§ˆæŠ¥å‘Šå›¾ç‰‡å¤±è´¥:', error);
                const previewContent = document.getElementById('report-preview-content');
                previewContent.innerHTML = '<p style="color: #e17055;">âŒ ç”Ÿæˆå¤±è´¥ï¼š' + error.message + '</p>';
            }
        }

        // æ˜¾ç¤ºå…¨å±å›¾ç‰‡
        function showFullscreenImage(imageDataUrl) {
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0,0,0,0.9);
                display: flex;
                justify-content: center;
                align-items: center;
                z-index: 1000;
                cursor: zoom-out;
            `;
            
            const img = document.createElement('img');
            img.src = imageDataUrl;
            img.style.cssText = `
                max-width: 90%;
                max-height: 90%;
                border-radius: 8px;
                box-shadow: 0 0 30px rgba(255,255,255,0.2);
            `;
            
            // å…³é—­æŒ‰é’®
            const closeBtn = document.createElement('button');
            closeBtn.textContent = 'âœ•';
            closeBtn.style.cssText = `
                position: absolute;
                top: 20px;
                right: 20px;
                background: rgba(255,255,255,0.2);
                border: none;
                color: white;
                width: 40px;
                height: 40px;
                border-radius: 50%;
                font-size: 18px;
                cursor: pointer;
                display: flex;
                align-items: center;
                justify-content: center;
            `;
            
            modal.appendChild(img);
            modal.appendChild(closeBtn);
            document.body.appendChild(modal);
            
            // å…³é—­åŠŸèƒ½
            const closeModal = () => {
                modal.remove();
            };
            
            closeBtn.onclick = closeModal;
            modal.onclick = (e) => {
                if (e.target === modal) {
                    closeModal();
                }
            };
            
            // ESCé”®å…³é—­
            document.addEventListener('keydown', function escHandler(e) {
                if (e.key === 'Escape') {
                    closeModal();
                    document.removeEventListener('keydown', escHandler);
                }
            });
        }

        // ä¿®æ”¹ç”ŸæˆæŠ¥å‘Šå‡½æ•°ï¼Œè‡ªåŠ¨é¢„è§ˆå›¾ç‰‡
        function generateReport() {
            nextStep('step-result', 'step-report');
            
            // è‡ªåŠ¨ç”ŸæˆæŠ¥å‘Šå†…å®¹
            const reportContent = document.getElementById('report-content');
            let reportHTML = `
                <div class="report-item">
                    <div class="report-item-title">ğŸ“‹ é¢è¯•åŸºæœ¬ä¿¡æ¯</div>
                    <div class="report-item-content">
                        <p>â€¢ å§“åï¼š${interviewData.candidate.name || 'æœªå¡«å†™'}</p>
                        <p>â€¢ é‚®ç®±ï¼š${interviewData.candidate.email || 'æœªå¡«å†™'}</p>
                        <p>â€¢ åº”è˜èŒä½ï¼š${interviewData.candidate.position || 'æœªå¡«å†™'}</p>
                        <p>â€¢ é¢è¯•ç±»å‹ï¼š${getNursingInterviewTypeName(interviewData.type)}</p>
                        <p>â€¢ é¢è¯•æ—¶é—´ï¼š${interviewData.startTime ? interviewData.startTime.toLocaleString() : 'æœªè®°å½•'}</p>
                        <p>â€¢ é¢è¯•æ—¶é•¿ï¼š${interviewData.startTime && interviewData.endTime ? Math.round((interviewData.endTime - interviewData.startTime) / 1000 / 60) + 'åˆ†é’Ÿ' : 'æœªè®°å½•'}</p>
                    </div>
                </div>
                
                <div class="report-item">
                    <div class="report-item-title">ğŸ¯ ç»¼åˆè¯„åˆ†åˆ†æ</div>
                    <div class="report-item-content">
                        <div style="text-align: center; margin-bottom: 20px;">
                            <div style="font-size: 3rem; font-weight: bold; color: ${getScoreColor(interviewData.score)};">${interviewData.score}</div>
                            <div style="font-size: 1.2rem; color: ${getScoreColor(interviewData.score)}; margin: 10px 0;">${getScoreLevel(interviewData.score)}</div>
                        </div>
                        
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin: 20px 0;">
                            <div style="background: rgba(0, 184, 148, 0.1); padding: 15px; border-radius: 8px; text-align: center;">
                                <div style="font-size: 1.5rem; font-weight: bold; color: #00b894;">${interviewData.details.content}</div>
                                <div style="font-size: 0.9rem; color: #636e72;">å†…å®¹å®Œæ•´æ€§</div>
                            </div>
                            <div style="background: rgba(0, 206, 201, 0.1); padding: 15px; border-radius: 8px; text-align: center;">
                                <div style="font-size: 1.5rem; font-weight: bold; color: #00cec9;">${interviewData.details.fluency}</div>
                                <div style="font-size: 0.9rem; color: #636e72;">è¡¨è¾¾æµç•…åº¦</div>
                            </div>
                            <div style="background: rgba(253, 203, 110, 0.1); padding: 15px; border-radius: 8px; text-align: center;">
                                <div style="font-size: 1.5rem; font-weight: bold; color: #fdcb6e;">${interviewData.details.structure}</div>
                                <div style="font-size: 0.9rem; color: #636e72;">ç»“æ„æ¸…æ™°åº¦</div>
                            </div>
                            <div style="background: rgba(225, 112, 85, 0.1); padding: 15px; border-radius: 8px; text-align: center;">
                                <div style="font-size: 1.5rem; font-weight: bold; color: #e17055;">${interviewData.details.confidence}</div>
                                <div style="font-size: 0.9rem; color: #636e72;">è‡ªä¿¡ç¨‹åº¦</div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="report-item">
                    <div class="report-item-title">âœ¨ ä¸ªäººä¼˜åŠ¿åˆ†æ</div>
                    <div class="report-item-content">
                        ${generateStrengthsAnalysis()}
                    </div>
                </div>
                
                <div class="report-item">
                    <div class="report-item-title">ğŸ“ é—®é¢˜ä¸å›ç­”åˆ†æ</div>
                    <div class="report-item-content">
            `;
            
            for (let i = 0; i < interviewData.questions.length; i++) {
                const feedback = interviewData.feedback && interviewData.feedback[i];
                const scoreColor = feedback ? getScoreColor(feedback.score) : '#636e72';
                
                reportHTML += `
                    <div style="margin: 20px 0; padding: 15px; background-color: rgba(74, 108, 247, 0.05); border-radius: 8px;">
                        <p style="margin: 0 0 10px 0;"><strong>é—®é¢˜ ${i + 1}ï¼š</strong>${interviewData.questions[i]}</p>
                        <p style="margin: 0 0 10px 0;"><strong>å›ç­”ï¼š</strong>${interviewData.answers[i] || 'æœªå›ç­”'}</p>
                        ${feedback ? `
                        <div style="margin-top: 10px; padding: 10px; background-color: rgba(0, 184, 148, 0.05); border-left: 3px solid ${scoreColor}; border-radius: 0 8px 8px 0;">
                            <p style="margin: 0 0 5px 0;"><strong>AIåé¦ˆï¼š</strong> <span style="color: ${scoreColor}; font-weight: bold;">è¯„åˆ† ${feedback.score}</span></p>
                            <p style="margin: 0;">${feedback.content}</p>
                        </div>
                        ` : ''}
                    </div>
                `;
            }
            
            reportHTML += `
                    </div>
                </div>
                
                <div class="report-item">
                    <div class="report-item-title">ğŸ’¡ ä¸ªæ€§åŒ–æ”¹è¿›å»ºè®®</div>
                    <div class="report-item-content">
                        ${generateImprovementTips()}
                    </div>
                </div>
                
                <div class="report-item">
                    <div class="report-item-title">ğŸ¯ æŠ¤ç†ä¸“ä¸šå‘å±•å»ºè®®</div>
                    <div class="report-item-content">
                        ${generateNursingCareerAdvice()}
                    </div>
                </div>
            `;
            
            reportContent.innerHTML = reportHTML;
            
            // è‡ªåŠ¨ç”ŸæˆæŠ¥å‘Šå›¾ç‰‡é¢„è§ˆ
            setTimeout(() => {
                previewReportImage();
            }, 500);
        }

        // ç”ŸæˆæŠ¤ç†ä¸“ä¸šå‘å±•å»ºè®®
        function generateNursingCareerAdvice() {
            const position = interviewData.candidate.position || 'æŠ¤å£«';
            let advice = '';
            
            if (interviewData.type === 'new-graduate') {
                advice += `<p>1. å¤¯å®æŠ¤ç†åŸºç¡€ç†è®ºï¼Œé‡ç‚¹æŒæ¡å¸¸è§ç—…ç§çš„æŠ¤ç†è¦ç‚¹</p>`;
                advice += `<p>2. ç§¯æå‚ä¸ä¸´åºŠå®ä¹ ï¼Œç§¯ç´¯å®é™…æ“ä½œç»éªŒ</p>`;
                advice += `<p>3. å­¦ä¹ æŠ¤ç†æ–‡ä¹¦è§„èŒƒï¼ŒæŒæ¡æ­£ç¡®çš„è®°å½•æ–¹æ³•</p>`;
                advice += `<p>4. åŸ¹å…»æ‚£è€…æ²Ÿé€šæŠ€å·§ï¼Œå»ºç«‹è‰¯å¥½æŠ¤æ‚£å…³ç³»</p>`;
            } else if (interviewData.type === 'junior-nurse') {
                advice += `<p>1. æå‡ä¸“ç§‘æŠ¤ç†æŠ€èƒ½ï¼Œå…³æ³¨ç‰¹å®šç§‘å®¤çš„ä¸“ä¸šè¦æ±‚</p>`;
                advice += `<p>2. å­¦ä¹ å›¢é˜Ÿåä½œæŠ€å·§ï¼Œæé«˜ä¸åŒ»ç”ŸåŒäº‹çš„é…åˆæ•ˆç‡</p>`;
                advice += `<p>3. åŸ¹å…»åº”æ€¥å¤„ç†èƒ½åŠ›ï¼ŒæŒæ¡å¸¸è§æ€¥ç—‡çš„æŠ¤ç†æµç¨‹</p>`;
                advice += `<p>4. å‚ä¸ç§‘å®¤è´¨é‡ç®¡ç†ï¼Œæå‡æŠ¤ç†æœåŠ¡æ°´å¹³</p>`;
            } else if (interviewData.type === 'senior-nurse') {
                advice += `<p>1. å‘æŒ¥ä¼ å¸®å¸¦ä½œç”¨ï¼ŒæŒ‡å¯¼å¹´è½»æŠ¤å£«æˆé•¿</p>`;
                advice += `<p>2. å‚ä¸æŠ¤ç†ç§‘ç ”å·¥ä½œï¼Œæ¨åŠ¨æŠ¤ç†æŠ€æœ¯åˆ›æ–°</p>`;
                advice += `<p>3. å­¦ä¹ æŠ¤ç†ç®¡ç†çŸ¥è¯†ï¼Œä¸ºæ™‹å‡ç®¡ç†å²—ä½åšå‡†å¤‡</p>`;
                advice += `<p>4. å…³æ³¨æŠ¤ç†å­¦ç§‘å‘å±•ï¼Œä¿æŒä¸“ä¸šçŸ¥è¯†çš„å…ˆè¿›æ€§</p>`;
            } else if (interviewData.type === 'specialty') {
                advice += `<p>1. æ·±åŒ–ä¸“ç§‘æŠ¤ç†çŸ¥è¯†ï¼Œæˆä¸ºè¯¥é¢†åŸŸçš„ä¸“å®¶</p>`;
                advice += `<p>2. å­¦ä¹ å…ˆè¿›çš„ä¸“ç§‘æŠ¤ç†æŠ€æœ¯ï¼Œæå‡ä¸“ä¸šç«äº‰åŠ›</p>`;
                advice += `<p>3. å‚ä¸ä¸“ç§‘æŠ¤ç†æ ‡å‡†çš„åˆ¶å®šå’Œå®Œå–„å·¥ä½œ</p>`;
                advice += `<p>4. åŸ¹å…»è·¨å­¦ç§‘åä½œèƒ½åŠ›ï¼Œæä¾›å…¨é¢çš„ä¸“ç§‘æŠ¤ç†æœåŠ¡</p>`;
            }
            
            advice += `<p>5. è€ƒå–ç›¸å…³èŒä¸šèµ„æ ¼è¯ä¹¦ï¼Œå¦‚æŠ¤å£«æ‰§ä¸šèµ„æ ¼è¯ã€ä¸“ç§‘æŠ¤å£«è¯ç­‰</p>`;
            advice += `<p>6. å‚åŠ ç»§ç»­æ•™è‚²å’Œå­¦æœ¯äº¤æµï¼ŒæŒç»­æ›´æ–°çŸ¥è¯†ç»“æ„</p>`;
            
            return advice;
        }

        // é‡å¯é¢è¯•
        function restartInterview() {
            // é‡ç½®é¢è¯•æ•°æ®
            interviewData = {
                candidate: {
                    name: '',
                    email: '',
                    position: ''
                },
                type: 'new-graduate',
                questionCount: 5,
                questions: [],
                answers: [],
                currentQuestionIndex: 0,
                startTime: null,
                endTime: null,
                score: 0,
                details: {
                    content: 0,
                    fluency: 0,
                    structure: 0,
                    confidence: 0
                }
            };
            
            // é‡ç½®è¡¨å•
            document.getElementById('name').value = '';
            document.getElementById('email').value = '';
            document.getElementById('position').value = '';
            document.getElementById('new-graduate').checked = true;
            document.getElementById('question-count').value = 5;
            document.getElementById('question-count-value').textContent = '5';
            
            // è¿”å›æ¬¢è¿é¡µé¢
            showStep('step-welcome');
        }

        // ä¸‹ä¸€æ­¥
        function nextStep(currentStep, nextStep) {
            if (currentStep === 'step-welcome' && nextStep === 'step-login') {
                // ä»æ¬¢è¿é¡µåˆ°ç™»å½•é¡µï¼Œæ— éœ€é¢å¤–æ“ä½œ
            } else if (currentStep === 'step-login' && nextStep === 'step-select') {
                // ä¿å­˜ç”¨æˆ·ä¿¡æ¯
                interviewData.candidate.name = document.getElementById('name').value;
                interviewData.candidate.email = document.getElementById('email').value;
                interviewData.candidate.position = document.getElementById('position').value;
                
                if (!interviewData.candidate.name || !interviewData.candidate.email || !interviewData.candidate.position) {
                    alert('è¯·å¡«å†™å®Œæ•´çš„ä¸ªäººä¿¡æ¯');
                    return;
                }
            } else if (currentStep === 'step-select' && nextStep === 'step-prepare') {
                // ä¿å­˜é¢è¯•ç±»å‹å’Œé—®é¢˜æ•°é‡
                interviewData.type = document.querySelector('input[name="interview-type"]:checked').value;
                interviewData.questionCount = parseInt(document.getElementById('question-count').value);
            } else if (currentStep === 'step-prepare' && nextStep === 'step-interview') {
                // å‡†å¤‡å¼€å§‹é¢è¯•ï¼Œåˆå§‹åŒ–è¯­éŸ³è¯†åˆ«
                initVoiceRecognition();
            }
            
            showStep(nextStep);
        }

        // ä¸Šä¸€æ­¥
        function prevStep(currentStep, prevStep) {
            showStep(prevStep);
        }

        // æ˜¾ç¤ºæŒ‡å®šæ­¥éª¤
        function showStep(stepId) {
            // è·å–å½“å‰æ´»åŠ¨æ­¥éª¤å’Œç›®æ ‡æ­¥éª¤
            const currentStep = document.querySelector('.step.active');
            const targetStep = document.getElementById(stepId);
            
            if (currentStep && currentStep !== targetStep) {
                // æ·»åŠ é€€å‡ºåŠ¨ç”»
                currentStep.classList.add('fade-out');
                
                // ç­‰å¾…é€€å‡ºåŠ¨ç”»å®Œæˆåæ˜¾ç¤ºæ–°æ­¥éª¤
                setTimeout(() => {
                    // éšè—æ‰€æœ‰æ­¥éª¤
                    document.querySelectorAll('.step').forEach(step => {
                        step.classList.remove('active', 'fade-out');
                    });
                    
                    // æ˜¾ç¤ºæ–°æ­¥éª¤ï¼Œæ·»åŠ è¿›å…¥åŠ¨ç”»
                    targetStep.classList.add('active', 'fade-in');
                }, 300);
            } else {
                // ç›´æ¥æ˜¾ç¤ºæ­¥éª¤ï¼ˆå¦‚æœæ˜¯ç¬¬ä¸€ä¸ªæ­¥éª¤æˆ–åŒä¸€æ­¥éª¤ï¼‰
                document.querySelectorAll('.step').forEach(step => {
                    step.classList.remove('active', 'fade-out');
                });
                targetStep.classList.add('active', 'fade-in');
            }
        }

        // å¼€å§‹é¢è¯•
        function startInterview() {
            nextStep('step-select', 'step-prepare');
        }

        // AIæ¨¡å‹è°ƒç”¨å‡½æ•°
        async function query_model(prompt, enable_thinking = false) {
            try {
                // åˆ›å»ºè¯·æ±‚é…ç½®
                const requestOptions = {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${AI_CONFIG.api_key}`
                    },
                    body: JSON.stringify({
                        model: AI_CONFIG.model,
                        messages: [
                            {
                                'role': 'system', 
                                'content': 'è¯·ç”¨è¿è´¯çš„ä¸­æ–‡å›ç­”ï¼Œå…ˆæ¨ç†å†ç»™ç»“è®ºã€‚ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„é¢è¯•è¯„ä¼°AIåŠ©æ‰‹ã€‚'
                            },
                            {
                                'role': 'user',
                                'content': prompt
                            }
                        ],
                        stream: false,
                        temperature: 0.7,
                        max_tokens: 512,
                        extra_body: {
                            enable_thinking: enable_thinking
                        }
                    })
                };

                // æ˜¾ç¤ºAIæ€è€ƒçŠ¶æ€
                updateInterviewerExpression('think');
                updateInterviewerFeedback('AIæ­£åœ¨åˆ†ææ‚¨çš„å›ç­”...');

                const response = await fetch(AI_CONFIG.base_url + '/chat/completions', requestOptions);
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const data = await response.json();
                
                // æ¢å¤æ•°å­—äººçŠ¶æ€
                updateInterviewerExpression('neutral');
                
                return data.choices[0].message.content;
            } catch (error) {
                console.error('AIæ¨¡å‹è°ƒç”¨é”™è¯¯:', error);
                updateInterviewerExpression('neutral');
                updateInterviewerFeedback('AIåˆ†ææš‚æ—¶ä¸å¯ç”¨ï¼Œè¯·ç»§ç»­é¢è¯•');
                return 'ç”±äºæŠ€æœ¯åŸå› ï¼ŒAIåˆ†ææš‚æ—¶ä¸å¯ç”¨ã€‚è¯·ç»§ç»­æ‚¨çš„é¢è¯•ã€‚';
            }
        }

        // å¢å¼ºçš„AIåé¦ˆç”Ÿæˆå‡½æ•°
        async function generateEnhancedAIFeedback(question, answer) {
            if (!answer || answer.trim().length < 10) {
                return {
                    score: 50,
                    tags: ['éœ€æ”¹è¿›', 'å†…å®¹å•è–„'],
                    content: 'æ‚¨çš„å›ç­”è¿‡äºç®€çŸ­ï¼Œå»ºè®®è¯¦ç»†é˜è¿°æ‚¨çš„æƒ³æ³•ã€‚'
                };
            }

            const prompt = `è¯·å¯¹ä»¥ä¸‹é¢è¯•å›ç­”è¿›è¡Œä¸“ä¸šè¯„ä¼°ï¼š

é—®é¢˜ï¼š${question}

å›ç­”ï¼š${answer}

è¯·ä»ä»¥ä¸‹ç»´åº¦è¿›è¡Œè¯„ä¼°ï¼š
1. å†…å®¹å®Œæ•´æ€§ï¼ˆæ˜¯å¦å…¨é¢å›ç­”é—®é¢˜ï¼‰
2. é€»è¾‘ç»“æ„ï¼ˆæ˜¯å¦æœ‰æ¡ç†ï¼‰
3. è¡¨è¾¾æµç•…åº¦ï¼ˆè¯­è¨€æ˜¯å¦é€šé¡ºï¼‰
4. ä¸“ä¸šæ€§ï¼ˆæ˜¯å¦ä½¿ç”¨ä¸“ä¸šæœ¯è¯­ï¼‰
5. è‡ªä¿¡ç¨‹åº¦ï¼ˆè¯­æ°”æ˜¯å¦è‡ªä¿¡ï¼‰

è¯·ç»™å‡ºï¼š
1. ç»¼åˆè¯„åˆ†ï¼ˆ0-100åˆ†ï¼‰
2. 3-5ä¸ªå…³é”®è¯æ ‡ç­¾
3. å…·ä½“çš„æ”¹è¿›å»ºè®®
4. é¼“åŠ±æ€§åé¦ˆ

è¯·ç”¨ä¸­æ–‡å›ç­”ï¼Œæ ¼å¼å¦‚ä¸‹ï¼š
è¯„åˆ†ï¼šXXåˆ†
æ ‡ç­¾ï¼šæ ‡ç­¾1ï¼Œæ ‡ç­¾2ï¼Œæ ‡ç­¾3
åé¦ˆï¼šè¯¦ç»†åé¦ˆå†…å®¹`;

            try {
                const aiResponse = await query_model(prompt, false);
                return parseAIFeedback(aiResponse, question, answer);
            } catch (error) {
                console.error('AIåé¦ˆç”Ÿæˆé”™è¯¯:', error);
                return analyzeAnswer(question, answer); // å›é€€åˆ°åŸºç¡€åˆ†æ
            }
        }

        // è§£æAIåé¦ˆç»“æœ
        function parseAIFeedback(aiResponse, question, answer) {
            // é»˜è®¤å€¼
            let score = 70;
            let tags = ['ä¸€èˆ¬', 'éœ€è¦æ”¹è¿›'];
            let content = 'AIåˆ†æå®Œæˆï¼Œè¯·å‚è€ƒå…·ä½“å»ºè®®ã€‚';

            try {
                // è§£æè¯„åˆ†
                const scoreMatch = aiResponse.match(/è¯„åˆ†[ï¼š:]\s*(\d+)/);
                if (scoreMatch) {
                    score = parseInt(scoreMatch[1]);
                }

                // è§£ææ ‡ç­¾
                const tagsMatch = aiResponse.match(/æ ‡ç­¾[ï¼š:]\s*([^\n]+)/);
                if (tagsMatch) {
                    tags = tagsMatch[1].split(/[ï¼Œ,]/).map(tag => tag.trim()).filter(tag => tag);
                }

                // è§£æåé¦ˆå†…å®¹
                const feedbackMatch = aiResponse.match(/åé¦ˆ[ï¼š:]\s*([\s\S]*?)(?=\n\n|$)/);
                if (feedbackMatch) {
                    content = feedbackMatch[1].trim();
                } else {
                    // å¦‚æœæ²¡æœ‰æ˜ç¡®æ ‡è®°ï¼Œä½¿ç”¨æ•´ä¸ªå“åº”ä½œä¸ºåé¦ˆ
                    content = aiResponse;
                }

                // ç¡®ä¿è¯„åˆ†åœ¨åˆç†èŒƒå›´å†…
                score = Math.min(Math.max(score, 0), 100);

                // å¦‚æœæ ‡ç­¾ä¸ºç©ºï¼Œä½¿ç”¨é»˜è®¤æ ‡ç­¾
                if (tags.length === 0) {
                    if (score >= 90) {
                        tags = ['ä¼˜ç§€', 'å†…å®¹å®Œæ•´', 'é€»è¾‘æ¸…æ™°'];
                    } else if (score >= 80) {
                        tags = ['è‰¯å¥½', 'è¡¨è¾¾æµç•…', 'ç»“æ„åˆç†'];
                    } else if (score >= 70) {
                        tags = ['ä¸€èˆ¬', 'éœ€è¦è¡¥å……', 'é€»è¾‘å¾…åŠ å¼º'];
                    } else {
                        tags = ['éœ€æ”¹è¿›', 'å†…å®¹å•è–„', 'ç»“æ„æ··ä¹±'];
                    }
                }

            } catch (error) {
                console.error('è§£æAIåé¦ˆé”™è¯¯:', error);
                // ä½¿ç”¨åŸºç¡€åˆ†æä½œä¸ºå¤‡ç”¨
                return analyzeAnswer(question, answer);
            }

            return {
                score: score,
                tags: tags,
                content: content
            };
        }

        // æ™ºèƒ½é—®é¢˜ç”Ÿæˆå‡½æ•°
        async function generateSmartQuestions(interviewType, questionCount) {
            const prompt = `è¯·ç”Ÿæˆ${questionCount}ä¸ª${getNursingInterviewTypeName(interviewType)}é¢è¯•é—®é¢˜ã€‚è¦æ±‚ï¼š
1. é—®é¢˜è¦æœ‰å±‚æ¬¡æ€§ï¼Œä»ç®€å•åˆ°å¤æ‚
2. æ¶µç›–æŠ¤ç†ä¸“ä¸šçŸ¥è¯†ã€ä¸´åºŠæŠ€èƒ½ã€æ‚£è€…æ²Ÿé€šã€å›¢é˜Ÿåä½œç­‰æ–¹é¢
3. é—®é¢˜è¦å…·æœ‰æŠ¤ç†ä¸“ä¸šæ€§å’Œå®ç”¨æ€§
4. æ¯ä¸ªé—®é¢˜å•ç‹¬ä¸€è¡Œï¼Œç”¨æ•°å­—ç¼–å·

è¯·ç”¨ä¸­æ–‡ç”Ÿæˆé—®é¢˜ã€‚`;

            try {
                const aiResponse = await query_model(prompt, false);
                return parseGeneratedQuestions(aiResponse, questionCount);
            } catch (error) {
                console.error('æ™ºèƒ½é—®é¢˜ç”Ÿæˆé”™è¯¯:', error);
                return generateNursingQuestions(); // å›é€€åˆ°æŠ¤å£«é¢„è®¾é—®é¢˜
            }
        }

        // è·å–æŠ¤å£«é¢è¯•ç±»å‹åç§°
        function getNursingInterviewTypeName(type) {
            const typeMap = {
                'new-graduate': 'åº”å±ŠæŠ¤ç†æ¯•ä¸šç”Ÿ',
                'junior-nurse': 'åˆçº§æŠ¤å£«',
                'senior-nurse': 'èµ„æ·±æŠ¤å£«',
                'specialty': 'ä¸“ç§‘æŠ¤å£«'
            };
            return typeMap[type] || 'æŠ¤ç†';
        }

        // è§£æç”Ÿæˆçš„é—®é¢˜
        function parseGeneratedQuestions(aiResponse, expectedCount) {
            const lines = aiResponse.split('\n').filter(line => 
                line.trim() && /^\d+[\.ã€]/.test(line.trim())
            );
            
            if (lines.length >= expectedCount) {
                return lines.slice(0, expectedCount).map(line => 
                    line.replace(/^\d+[\.ã€]\s*/, '').trim()
                );
            }
            
            // å¦‚æœè§£æå¤±è´¥ï¼Œä½¿ç”¨æŠ¤å£«é¢„è®¾é—®é¢˜
            return generateNursingQuestions();
        }

        // ç”ŸæˆæŠ¤å£«ä¸“ä¸šé¢è¯•é—®é¢˜ï¼ˆå·²åˆ é™¤é‡å¤å®šä¹‰ï¼‰

        // ä¿®æ”¹ç”ŸæˆAIåé¦ˆå‡½æ•°ï¼Œä½¿ç”¨å¢å¼ºç‰ˆæœ¬
        async function generateAIFeedback() {
            const currentIndex = interviewData.currentQuestionIndex;
            const question = interviewData.questions[currentIndex];
            const answer = interviewData.answers[currentIndex] || '';
            
            // æ˜¾ç¤ºåˆ†æçŠ¶æ€
            updateInterviewerExpression('think');
            updateInterviewerFeedback('AIæ­£åœ¨æ·±åº¦åˆ†ææ‚¨çš„å›ç­”...');
            
            // ä½¿ç”¨å¢å¼ºçš„AIåé¦ˆ
            const feedback = await generateEnhancedAIFeedback(question, answer);
            
            // æ˜¾ç¤ºå®æ—¶åé¦ˆ
            displayFeedback(feedback);
            
            // æ›´æ–°æ•°å­—äººçŠ¶æ€
            updateInterviewerExpression('nod');
            
            // æ ¹æ®è¯„åˆ†ç»™å‡ºä¸åŒçš„é¼“åŠ±
            setTimeout(() => {
                if (feedback.score >= 90) {
                    updateInterviewerExpression('smile');
                    updateInterviewerFeedback('å¤ªæ£’äº†ï¼æ‚¨çš„å›ç­”éå¸¸å‡ºè‰²ï¼');
                } else if (feedback.score >= 80) {
                    updateInterviewerExpression('neutral');
                    updateInterviewerFeedback('å›ç­”å¾—å¾ˆå¥½ï¼Œç»§ç»­åŠ æ²¹ï¼');
                } else if (feedback.score >= 70) {
                    updateInterviewerExpression('think');
                    updateInterviewerFeedback('æœ‰è¿›æ­¥ç©ºé—´ï¼Œå‚è€ƒå»ºè®®ç»§ç»­æ”¹è¿›ã€‚');
                } else {
                    updateInterviewerExpression('neutral');
                    updateInterviewerFeedback('åˆ«ç°å¿ƒï¼Œæ¯ä¸ªé—®é¢˜éƒ½æ˜¯å­¦ä¹ çš„æœºä¼šã€‚');
                }
            }, 1000);
        }

        // ä¿®æ”¹å¼€å§‹é¢è¯•å‡½æ•°ï¼Œæ”¯æŒAIç”Ÿæˆé—®é¢˜
        async function startInterviewSession() {
            // åˆå§‹åŒ–é¢è¯•æ•°æ®
            interviewData.startTime = new Date();
            interviewData.currentQuestionIndex = 0;
            interviewData.answers = [];
            
            // æ˜¾ç¤ºé¢è¯•é¡µé¢
            nextStep('step-prepare', 'step-interview');
            
            // æ˜¾ç¤ºç”Ÿæˆé—®é¢˜çŠ¶æ€
            updateInterviewerExpression('think');
            updateInterviewerFeedback('AIæ­£åœ¨ä¸ºæ‚¨ç”Ÿæˆä¸ªæ€§åŒ–é¢è¯•é—®é¢˜...');
            
            try {
                // ä½¿ç”¨AIç”Ÿæˆé—®é¢˜
                interviewData.questions = await generateSmartQuestions(interviewData.type, interviewData.questionCount);
                
                // æ˜¾ç¤ºç¬¬ä¸€ä¸ªé—®é¢˜
                displayCurrentQuestion();
                
                // å¼€å§‹è®¡æ—¶
                startTimer();
                
            } catch (error) {
                console.error('é—®é¢˜ç”Ÿæˆå¤±è´¥:', error);
                // å›é€€åˆ°æŠ¤å£«é¢„è®¾é—®é¢˜
                interviewData.questions = generateNursingQuestions();
                displayCurrentQuestion();
                startTimer();
            }
        }

        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            // åˆå§‹åŒ–é—®é¢˜æ•°é‡æ˜¾ç¤º
            const questionCount = document.getElementById('question-count');
            const questionCountValue = document.getElementById('question-count-value');
            
            questionCount.addEventListener('input', function() {
                questionCountValue.textContent = this.value;
            });

            // æµ‹è¯•AIè¿æ¥ï¼ˆå¯é€‰ï¼‰
            // testAIConnection();
        });

        // æµ‹è¯•AIè¿æ¥å‡½æ•°ï¼ˆå¯é€‰ï¼‰
        async function testAIConnection() {
            try {
                const testResponse = await query_model('è¯·ç®€å•å›å¤"è¿æ¥æˆåŠŸ"', false);
                console.log('AIè¿æ¥æµ‹è¯•æˆåŠŸ:', testResponse);
            } catch (error) {
                console.warn('AIè¿æ¥æµ‹è¯•å¤±è´¥ï¼Œå°†ä½¿ç”¨æœ¬åœ°åˆ†ææ¨¡å¼');
            }
        }
    </script>
</body>
</html>